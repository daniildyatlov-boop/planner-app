<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="version" content="v6.10.1-FIX-PROGRESS-NUMBERS">
<title>–ü–ª–∞–Ω–µ—Ä v6.10.1 Fix Progress Numbers</title>
<script src="https://telegram.org/js/telegram-web-app.js?v=7"></script>
<style>
/* RESET & BASE */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;position:fixed;width:100%}
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
  color:var(--text-primary);
  line-height:1.4;
  overflow:hidden;
}

/* SMOOTH ANIMATIONS SYSTEM */
* {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ easing —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞–Ω–∏–º–∞—Ü–∏–π */
.ease-bounce { transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55); }
.ease-smooth { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }
.ease-swift { transition-timing-function: cubic-bezier(0.55, 0, 0.1, 1); }
.ease-gentle { transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94); }

/* –ú–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
@keyframes gentle-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

@keyframes soft-glow {
  0%, 100% { box-shadow: 0 0 20px rgba(99,102,241,0.3); }
  50% { box-shadow: 0 0 30px rgba(99,102,241,0.5); }
}

@keyframes fade-in-up {
  from { 
    opacity: 0; 
    transform: translateY(20px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

@keyframes scale-in {
  from { 
    opacity: 0; 
    transform: scale(0.9); 
  }
  to { 
    opacity: 1; 
    transform: scale(1); 
  }
}

/* DESIGN SYSTEM - CONSISTENT SPACING */
:root {
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 12px;
  --spacing-lg: 16px;
  --spacing-xl: 20px;
  --spacing-2xl: 24px;
  --spacing-3xl: 32px;
  --border-radius: 16px;
  --border-radius-sm: 12px;
  --border-radius-lg: 20px;
  
  /* –ù–æ–≤–∞—è –ø—Ä–∏—è—Ç–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
  --bg-primary: #0f0f0f;
  --bg-secondary: #1a1a1a;
  --bg-tertiary: #252525;
  --bg-card: rgba(26, 26, 26, 0.8);
  --bg-card-hover: rgba(35, 35, 35, 0.9);
  
  --accent-primary: #6366f1;
  --accent-secondary: #8b5cf6;
  --accent-soft: #a855f7;
  
  --text-primary: #ffffff;
  --text-secondary: #a1a1aa;
  --text-muted: #71717a;
  
  --border-primary: rgba(63, 63, 70, 0.4);
  --border-secondary: rgba(63, 63, 70, 0.2);
}

/* APP LAYOUT */
.app{
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  animation: fade-in-up 0.6s ease-smooth;
}
.header{
  padding:var(--spacing-lg) var(--spacing-xl);
  background: rgba(15, 15, 15, 0.95);
  backdrop-filter: blur(20px);
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:relative;
  height:72px;
  flex-shrink:0;
  border-bottom:1px solid var(--border-secondary);
  box-shadow: 0 1px 20px rgba(0, 0, 0, 0.3);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.content{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* HEADER ELEMENTS */
.profile-btn{
  width:44px;
  height:44px;
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  border:none;
  border-radius:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:var(--spacing-lg);
  font-weight:600;
  cursor:pointer;
  flex-shrink:0;
  box-shadow:0 4px var(--spacing-md) rgba(99,102,241,0.3);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0); /* GPU acceleration */
}
.profile-btn:hover{
  animation: gentle-pulse 2s infinite;
}
.profile-btn:active{
  opacity:0.8;
  transform:scale(0.92);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.date-nav{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  align-items:center;
  background:rgba(28,28,30,0.8);
  backdrop-filter: blur(20px);
  border-radius:var(--spacing-lg);
  padding:var(--spacing-xs);
  box-shadow:0 8px 32px rgba(0,0,0,0.3);
  height:var(--spacing-3xl);
  gap:var(--spacing-xs);
  border:1px solid rgba(44,44,46,0.6);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.date-nav:hover{
  transform:translateX(-50%) translateY(-1px);
  box-shadow:0 12px 40px rgba(0,0,0,0.4);
}
.nav-arrow{
  background:none;
  border:none;
  font-size:14px;
  color:#6366f1;
  cursor:pointer;
  width:var(--spacing-2xl);
  height:var(--spacing-2xl);
  border-radius:var(--spacing-md);
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0);
}
.nav-arrow:active{
  opacity:0.6;
  background:rgba(99,102,241,0.2);
  transform:scale(0.9);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.date-content{
  display:flex;
  flex-direction:column;
  align-items:center;
  cursor:pointer;
  padding:0 var(--spacing-sm);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.date-content:active{
  transform: scale(0.95);
}
.date-title{
  font-size:var(--spacing-md);
  font-weight:600;
  color:#ffffff;
  line-height:1;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.date-subtitle{
  font-size:10px;
  color:#8e8e93;
  line-height:1;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.rooms-btn{
  width:44px;
  height:44px;
  background:rgba(28,28,30,0.8);
  backdrop-filter: blur(20px);
  border:1px solid rgba(44,44,46,0.6);
  border-radius:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 4px 16px rgba(0,0,0,0.3);
  font-size:var(--spacing-lg);
  flex-shrink:0;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0);
}
.rooms-btn:hover{
  transform: translateY(-1px);
  box-shadow:0 8px 24px rgba(0,0,0,0.4);
}
.rooms-btn:active{
  opacity:0.8;
  transform:scale(0.92);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

/* PROGRESS BAR */
.progress-container{
  margin:var(--spacing-xl) var(--spacing-xl) var(--spacing-2xl);
  flex-shrink:0;
  animation: fade-in-up 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
  background: linear-gradient(135deg, 
    rgba(99, 102, 241, 0.1) 0%, 
    rgba(139, 92, 246, 0.1) 50%,
    rgba(168, 85, 247, 0.1) 100%);
  backdrop-filter: blur(30px);
  border-radius: var(--border-radius-lg);
  padding: var(--spacing-2xl);
  border: 1px solid rgba(99, 102, 241, 0.2);
  box-shadow: 
    0 12px 40px rgba(99, 102, 241, 0.15),
    0 1px 0 rgba(255, 255, 255, 0.1) inset,
    0 0 0 1px rgba(99, 102, 241, 0.1) inset;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.progress-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent, 
    rgba(99, 102, 241, 0.1), 
    transparent);
  animation: progress-shimmer 4s infinite;
}
@keyframes progress-shimmer {
  0% { left: -100%; }
  100% { left: 100%; }
}

.progress-info{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:var(--spacing-xl);
  position: relative;
  z-index: 1;
  width: 100%;
}
.progress-label{
  font-size:16px;
  color:var(--text-primary);
  font-weight:700;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
  letter-spacing: 0.5px;
}
.progress-stats{
  font-size:18px;
  color:var(--accent-primary);
  font-weight:800;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-shadow: 0 0 16px rgba(99, 102, 241, 0.5);
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* –ö–†–£–ì–õ–´–ô –ü–†–û–ì–†–ï–°–°-–ë–ê–† */
.progress-circle-container {
  position: relative;
  width: 120px;
  height: 120px;
  z-index: 1;
}
.progress-circle {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    var(--accent-primary) 0deg,
    var(--accent-secondary) 120deg,
    var(--accent-soft) 240deg,
    rgba(0, 0, 0, 0.2) 0deg
  );
  padding: 6px;
  box-shadow: 
    0 8px 32px rgba(99, 102, 241, 0.3),
    0 0 0 2px rgba(99, 102, 241, 0.2) inset;
  transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}
.progress-circle-inner {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}
.progress-percentage {
  font-size: 24px;
  font-weight: 800;
  color: var(--text-primary);
  text-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* –ê–ù–ò–ú–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ò–Ø */
.progress-container.completed {
  animation: celebration-pulse 2s infinite ease-in-out;
}
.progress-circle.completed {
  background: conic-gradient(
    from 0deg,
    var(--accent-primary) 0deg,
    var(--accent-secondary) 120deg,
    var(--accent-soft) 240deg,
    var(--accent-primary) 360deg
  );
  box-shadow: 
    0 16px 48px rgba(99, 102, 241, 0.5),
    0 0 0 4px rgba(99, 102, 241, 0.3) inset,
    0 0 32px rgba(99, 102, 241, 0.4);
  animation: completion-glow 3s infinite ease-in-out;
}
.progress-percentage.completed {
  color: var(--accent-primary);
  text-shadow: 0 0 16px rgba(99, 102, 241, 0.6);
  animation: completion-text 2s infinite ease-in-out;
}

@keyframes celebration-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}
@keyframes completion-glow {
  0%, 100% { 
    box-shadow: 
      0 16px 48px rgba(99, 102, 241, 0.5),
      0 0 0 4px rgba(99, 102, 241, 0.3) inset,
      0 0 32px rgba(99, 102, 241, 0.4);
  }
  50% { 
    box-shadow: 
      0 20px 60px rgba(99, 102, 241, 0.7),
      0 0 0 6px rgba(99, 102, 241, 0.5) inset,
      0 0 48px rgba(99, 102, 241, 0.6);
  }
}
@keyframes completion-text {
  0%, 100% { 
    transform: scale(1);
    text-shadow: 0 0 16px rgba(99, 102, 241, 0.6);
  }
  50% { 
    transform: scale(1.05);
    text-shadow: 0 0 24px rgba(99, 102, 241, 0.8);
  }
}

/* EMPTY STATE */
.empty{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:40px var(--spacing-xl);
  flex:1;
  animation: fade-in-up 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
}
.empty h2{
  font-size:18px;
  font-weight:600;
  margin-bottom:var(--spacing-sm);
  color:#ffffff;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-shadow: 0 2px 8px rgba(255,255,255,0.1);
}
.empty p{
  font-size:15px;
  color:#8e8e93;
  margin-bottom:var(--spacing-2xl);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* BUTTONS */
.btn{
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  color:white;
  border:none;
  border-radius:var(--border-radius);
  padding:var(--spacing-md) var(--spacing-2xl);
  font-size:var(--spacing-lg);
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:0 4px var(--spacing-md) rgba(99,102,241,0.3);
  transform: translateZ(0);
  position: relative;
  overflow: hidden;
}
.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
.btn:hover::before {
  left: 100%;
}
.btn:hover{
  transform: translateY(-2px);
  box-shadow:0 8px 24px rgba(99,102,241,0.4);
  animation: soft-glow 2s infinite;
}
.btn:active{
  opacity:0.9;
  transform:scale(0.96);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.header-btn{
  background:none;
  border:none;
  font-size:var(--spacing-lg);
  color:#6366f1;
  cursor:pointer;
  padding:var(--spacing-sm) var(--spacing-md);
  border-radius:var(--spacing-sm);
  font-weight:500;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0);
  position: relative;
  overflow: hidden;
}
.header-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(99,102,241,0.1);
  border-radius: var(--spacing-sm);
  transform: scale(0);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.header-btn:hover::before {
  transform: scale(1);
}
.header-btn:hover {
  color: #8b5cf6;
  transform: translateY(-1px);
  text-shadow: 0 0 8px rgba(99,102,241,0.3);
}
.header-btn:active{
  opacity:0.7;
  transform:scale(0.95);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

/* PLANS LIST */
.plans-container{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.plans{
  flex:1;
  overflow-y:auto;
  padding:0;
}
.plans::-webkit-scrollbar{display:none}

.add-task-section{
  padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-2xl);
  background: linear-gradient(180deg, rgba(15, 15, 15, 0.8) 0%, rgba(15, 15, 15, 1) 100%);
  border-top: 1px solid var(--border-secondary);
}
.add-task-btn{
  width: 100%;
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border-primary);
  border-radius: var(--border-radius);
  padding: var(--spacing-xl);
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  color: var(--accent-primary);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.2),
    0 1px 0 rgba(255, 255, 255, 0.05) inset;
  transform: translateZ(0);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-md);
  position: relative;
  overflow: hidden;
}
.add-task-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
  opacity: 0;
  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.add-task-btn:hover {
  background: var(--bg-card-hover);
  border-color: rgba(99, 102, 241, 0.3);
  color: var(--accent-secondary);
  transform: translateY(-2px);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.3),
    0 1px 0 rgba(255, 255, 255, 0.1) inset;
}
.add-task-btn:hover::before {
  opacity: 1;
}
.add-task-btn:active {
  opacity: 0.8;
  transform: scale(0.98);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}
.add-icon {
  font-size: 20px;
  font-weight: 300;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-shadow: 0 0 8px rgba(99, 102, 241, 0.3);
}
.add-task-btn:hover .add-icon {
  transform: rotate(90deg) scale(1.1);
  text-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
}

.plan{
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border-primary);
  border-radius: var(--border-radius);
  padding: var(--spacing-xl);
  margin: 0 var(--spacing-xl) var(--spacing-lg);
  display: flex;
  align-items: center;
  cursor: pointer;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.2),
    0 1px 0 rgba(255, 255, 255, 0.05) inset;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  min-height: 72px;
  transform: translateZ(0);
  animation: fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1) both;
  position: relative;
  overflow: hidden;
}
.plan::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
  opacity: 0;
  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.plan:nth-child(1) { animation-delay: 0.1s; }
.plan:nth-child(2) { animation-delay: 0.15s; }
.plan:nth-child(3) { animation-delay: 0.2s; }
.plan:nth-child(4) { animation-delay: 0.25s; }
.plan:nth-child(5) { animation-delay: 0.3s; }

.plan:hover {
  transform: translateY(-4px);
  box-shadow: 
    0 16px 48px rgba(0, 0, 0, 0.3),
    0 1px 0 rgba(255, 255, 255, 0.1) inset;
  border-color: rgba(99, 102, 241, 0.3);
}
.plan:hover::before {
  opacity: 1;
}
.plan:active {
  opacity: 0.9;
  transform: scale(0.98) translateY(-2px);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}
.plan.completed {
  opacity: 0.7;
  transform: scale(0.98);
  background: var(--bg-secondary);
}
.plan.completed .plan-title {
  color: var(--text-muted);
  position: relative;
  --text-width: 100%;
}
.plan.completed .plan-title::after{
  content: '';
  position: absolute;
  top: 50%;
  left: 0;
  width: 0;
  max-width: var(--text-width);
  height: 2px;
  background: linear-gradient(90deg, var(--text-muted), var(--text-secondary));
  border-radius: 1px;
  transform: translateY(-50%);
  animation: strikethrough-text 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è —Ç–æ—á–Ω–æ –ø–æ —Ç–µ–∫—Å—Ç—É */
@keyframes strikethrough-text {
  0% {
    width: 0;
    opacity: 0;
  }
  20% {
    opacity: 1;
  }
  100% {
    width: var(--text-width);
    opacity: 1;
  }
}

/* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—É—é –∞–Ω–∏–º–∞—Ü–∏—é */
.plan.completed.animate-strike .plan-title::after {
  animation: strikethrough-text 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.checkbox{
  width: 24px;
  height: 24px;
  border: 2px solid var(--accent-primary);
  border-radius: 12px;
  margin-right: var(--spacing-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  transform: translateZ(0);
  background: var(--bg-tertiary);
  box-shadow: 
    0 2px 8px rgba(0, 0, 0, 0.3) inset,
    0 1px 0 rgba(255, 255, 255, 0.1);
}
.checkbox:hover {
  transform: scale(1.1);
  box-shadow: 
    0 0 20px rgba(99, 102, 241, 0.4),
    0 2px 8px rgba(0, 0, 0, 0.3) inset;
  border-color: var(--accent-secondary);
}
.checkbox.checked {
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border-color: var(--accent-primary);
  box-shadow: 
    0 0 20px rgba(99, 102, 241, 0.5),
    0 1px 0 rgba(255, 255, 255, 0.3) inset;
  transform: scale(1.05);
}
.checkbox.checked::after {
  content: '‚úì';
  color: white;
  font-size: 14px;
  font-weight: bold;
  animation: checkmark-appear 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –≥–∞–ª–æ—á–∫–∏ */
@keyframes checkmark-appear {
  0% {
    transform: scale(0) rotate(-45deg);
    opacity: 0;
  }
  50% {
    transform: scale(1.2) rotate(-22deg);
    opacity: 1;
  }
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
}

.plan-content{
  flex:1;
  display:flex;
  flex-direction:column;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.plan-title{
  font-size: 17px;
  color: var(--text-primary);
  font-weight: 500;
  line-height: 1.4;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}
.room{
  font-size: 13px;
  color: var(--accent-soft);
  background: rgba(168, 85, 247, 0.15);
  backdrop-filter: blur(10px);
  padding: var(--spacing-xs) var(--spacing-md);
  border-radius: 8px;
  display: inline-block;
  margin-top: var(--spacing-xs);
  line-height: 1;
  font-weight: 600;
  border: 1px solid rgba(168, 85, 247, 0.3);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 8px rgba(168, 85, 247, 0.2);
  transform: translateZ(0);
}
.room:hover {
  background: rgba(168, 85, 247, 0.25);
  border-color: rgba(168, 85, 247, 0.5);
  box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
  transform: translateY(-1px);
}

/* MODALS */
.modal{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:#0a0a0a;
  z-index:100;
  display:none;
  flex-direction:column;
  transform:translateY(100%);
  transition:transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  height:100vh;
  overflow:hidden;
  backdrop-filter: blur(20px);
}
.modal.show{
  display:flex;
  transform:translateY(0);
}
.modal.show .modal-content{
  animation: fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
}

.modal-header{
  padding:var(--spacing-lg) var(--spacing-xl);
  background:rgba(28,28,30,0.8);
  backdrop-filter: blur(20px);
  border-bottom:1px solid rgba(44,44,46,0.6);
  display:flex;
  align-items:center;
  justify-content:space-between;
  flex-shrink:0;
  box-shadow: 0 2px 16px rgba(0,0,0,0.1);
}
.modal-title{
  font-size:var(--spacing-lg);
  font-weight:600;
  color:#ffffff;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-content{
  flex:1;
  overflow-y:auto;
  padding:var(--spacing-xl);
  background: linear-gradient(180deg, rgba(10,10,10,0.95) 0%, rgba(10,10,10,1) 100%);
}
.modal-content::-webkit-scrollbar{display:none}

/* FORMS */
.form-group{
  margin-bottom:var(--spacing-xl);
  animation: fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1) both;
}
.form-group:nth-child(1) { animation-delay: 0.1s; }
.form-group:nth-child(2) { animation-delay: 0.15s; }
.form-group:nth-child(3) { animation-delay: 0.2s; }

.label{
  font-size:var(--spacing-md);
  color:#8e8e93;
  text-transform:uppercase;
  letter-spacing:0.5px;
  font-weight:600;
  margin-bottom:var(--spacing-xs);
  display:block;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.input,.select{
  width:100%;
  background:rgba(28,28,30,0.8);
  backdrop-filter: blur(20px);
  border:1px solid rgba(44,44,46,0.6);
  border-radius:10px;
  padding:var(--spacing-md);
  font-size:var(--spacing-lg);
  font-family:inherit;
  color:#ffffff;
  transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  transform: translateZ(0);
}
.input:focus,.select:focus{
  outline:none;
  border-color:#6366f1;
  box-shadow:0 0 0 3px rgba(99,102,241,0.2), 0 8px 24px rgba(0,0,0,0.2);
  background:rgba(28,28,30,0.95);
  transform: translateY(-2px);
}
.input:hover,.select:hover{
  border-color:rgba(99,102,241,0.4);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  transform: translateY(-1px);
}
.input::placeholder{
  color:#6b7280;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.select-wrapper{
  position:relative;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.select{
  appearance:none;
  cursor:pointer;
}
.select-wrapper::after{
  content:'‚Ä∫';
  position:absolute;
  right:var(--spacing-md);
  top:50%;
  transform:translateY(-50%) rotate(90deg);
  color:#6b7280;
  font-size:var(--spacing-lg);
  pointer-events:none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.select:focus + .select-wrapper::after,
.select-wrapper:hover::after {
  color: #6366f1;
  transform:translateY(-50%) rotate(90deg) scale(1.1);
}

/* CALENDAR */
.calendar{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.8);
  backdrop-filter: blur(20px);
  z-index:200;
  display:none;
  align-items:center;
  justify-content:center;
  opacity:0;
  transition:opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.calendar.show{
  display:flex;
  opacity:1;
}
.calendar-content{
  background:rgba(28,28,30,0.95);
  backdrop-filter: blur(40px);
  border:1px solid rgba(44,44,46,0.6);
  border-radius:var(--border-radius);
  padding:var(--spacing-xl);
  margin:var(--spacing-xl);
  max-width:300px;
  width:100%;
  box-shadow:0 16px 64px rgba(0,0,0,0.4);
  transform: scale(0.9);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.calendar.show .calendar-content{
  transform: scale(1);
  animation: scale-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
.calendar-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:var(--spacing-lg);
}
.calendar-title{
  font-size:var(--spacing-lg);
  font-weight:600;
  color:#ffffff;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.calendar-nav{
  background:rgba(99,102,241,0.1);
  backdrop-filter: blur(10px);
  border:1px solid rgba(99,102,241,0.2);
  font-size:18px;
  color:#6366f1;
  cursor:pointer;
  width:var(--spacing-3xl);
  height:var(--spacing-3xl);
  border-radius:var(--spacing-lg);
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0);
}
.calendar-nav:hover{
  background:rgba(99,102,241,0.2);
  border-color:rgba(99,102,241,0.4);
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(99,102,241,0.3);
}
.calendar-nav:active{
  opacity:0.7;
  transform:scale(0.95);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.weekdays{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:var(--spacing-xs);
  margin-bottom:var(--spacing-sm);
}
.weekday{
  font-size:var(--spacing-md);
  color:#8e8e93;
  text-align:center;
  padding:var(--spacing-xs);
  font-weight:500;
}

.calendar-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:var(--spacing-xs);
}
.calendar-day{
  background:rgba(44,44,46,0.3);
  backdrop-filter: blur(10px);
  border:1px solid rgba(44,44,46,0.4);
  padding:var(--spacing-sm);
  font-size:14px;
  cursor:pointer;
  border-radius:var(--spacing-xs);
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:var(--spacing-3xl);
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  color:#ffffff;
  transform: translateZ(0);
  font-weight: 500;
}
.calendar-day:hover{
  background:rgba(99,102,241,0.2);
  border-color:rgba(99,102,241,0.4);
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(99,102,241,0.2);
}
.calendar-day:active{
  transform:scale(0.95);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}
.calendar-day.today{
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  color:white;
  box-shadow:0 4px 16px rgba(99,102,241,0.4);
  border-color: transparent;
  font-weight: 600;
  animation: soft-glow 3s infinite;
}
.calendar-day.selected{
  background:linear-gradient(135deg, #8b5cf6, #a855f7);
  color:white;
  box-shadow:0 4px 16px rgba(139,92,246,0.4);
  border-color: transparent;
  font-weight: 600;
}
.calendar-day.other-month{
  color:#6b7280;
  opacity: 0.5;
}

/* EDIT PLAN SCREEN */
.edit-plan-input{
  font-size:18px;
  font-weight:500;
  background:#2c2c2e;
  border:none;
  border-radius:var(--spacing-md);
  padding:var(--spacing-lg);
  color:#ffffff;
  margin-bottom:var(--spacing-xl);
}
.edit-plan-input:focus{
  outline:none;
  background:#3c3c3e;
}

.form-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:#2c2c2e;
  border-radius:var(--spacing-md);
  padding:var(--spacing-lg);
  cursor:pointer;
  transition:all 0.2s ease;
}
.form-row:active{
  background:#3c3c3e;
}
.form-row span{
  color:#ffffff;
  font-size:var(--spacing-lg);
}

.toggle{
  width:50px;
  height:30px;
  background:#3c3c3e;
  border-radius:15px;
  position:relative;
  cursor:pointer;
  transition:all 0.3s ease;
}
.toggle.active{
  background:#6366f1;
}
.toggle-slider{
  width:26px;
  height:26px;
  background:#ffffff;
  border-radius:13px;
  position:absolute;
  top:2px;
  left:2px;
  transition:all 0.3s ease;
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.toggle.active .toggle-slider{
  transform:translateX(20px);
}

.premium-notice{
  display:flex;
  align-items:center;
  background:#2c2c2e;
  border-radius:var(--spacing-md);
  padding:var(--spacing-lg);
  margin:var(--spacing-xl) 0;
  font-size:var(--spacing-md);
  color:#8e8e93;
  line-height:1.4;
}
.premium-icon{
  font-size:var(--spacing-lg);
  margin-right:var(--spacing-sm);
  flex-shrink:0;
}
.premium-link{
  color:#6366f1;
  font-weight:500;
}

.delete-btn{
  width:100%;
  background:none;
  border:none;
  color:#ef4444;
  font-size:var(--spacing-lg);
  font-weight:500;
  padding:var(--spacing-lg);
  text-align:center;
  cursor:pointer;
  border-radius:var(--spacing-md);
  transition:all 0.2s ease;
  margin-top:var(--spacing-xl);
}
.delete-btn:active{
  background:rgba(239,68,68,0.1);
}

.screen-footer{
  padding:var(--spacing-lg) var(--spacing-xl) var(--spacing-3xl);
  background:#0a0a0a;
  border-top:1px solid #2c2c2e;
}
.save-btn{
  width:100%;
  background:#6366f1;
  color:white;
  border:none;
  border-radius:var(--spacing-md);
  padding:var(--spacing-lg);
  font-size:var(--spacing-lg);
  font-weight:600;
  cursor:pointer;
  transition:all 0.2s ease;
}
.save-btn:active{
  opacity:0.8;
  transform:scale(0.98);
}

/* SIMPLE MENU */
.overlay{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.8);
  backdrop-filter: blur(20px);
  z-index:150;
  display:none;
  opacity:0;
  transition:opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  align-items:center;
  justify-content:center;
}
.overlay.show{
  display:flex;
  opacity:1;
}
.menu{
  background:rgba(28,28,30,0.95);
  backdrop-filter: blur(40px);
  border:1px solid rgba(44,44,46,0.6);
  border-radius:var(--border-radius);
  min-width:250px;
  box-shadow:0 16px 64px rgba(0,0,0,0.4);
  overflow:hidden;
  transform: scale(0.9);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.overlay.show .menu{
  transform: scale(1);
  animation: scale-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
.menu-btn{
  width:100%;
  background:none;
  border:none;
  padding:var(--spacing-lg) var(--spacing-xl);
  font-size:var(--spacing-lg);
  text-align:center;
  cursor:pointer;
  color:#6366f1;
  font-weight:500;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}
.menu-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: rgba(99,102,241,0.1);
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.menu-btn:hover::before {
  left: 0;
}
.menu-btn:not(:last-child){
  border-bottom:1px solid rgba(44,44,46,0.6);
}
.menu-btn:hover{
  color: #8b5cf6;
  text-shadow: 0 0 8px rgba(99,102,241,0.3);
}
.menu-btn:active{
  transform:scale(0.95);
  opacity: 0.7;
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}
.menu-btn.del{
  color:#ef4444;
}
.menu-btn.del:hover{
  color:#f87171;
  text-shadow: 0 0 8px rgba(239,68,68,0.3);
}



/* SCREENS */
.screen{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:#0a0a0a;
  z-index:100;
  display:none;
  flex-direction:column;
  height:100vh;
  overflow:hidden;
  transform:translateX(100%);
  transition:transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
.screen.show{
  display:flex;
  transform:translateX(0);
}
.screen.show .screen-content{
  animation: fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
}

.screen-header{
  padding:var(--spacing-md) var(--spacing-xl);
  background:rgba(28,28,30,0.8);
  backdrop-filter: blur(20px);
  border-bottom:1px solid rgba(44,44,46,0.6);
  display:flex;
  align-items:center;
  justify-content:space-between;
  height:68px;
  flex-shrink:0;
  box-shadow: 0 2px 16px rgba(0,0,0,0.1);
}
.screen-content{
  flex:1;
  overflow-y:auto;
  padding:var(--spacing-xl);
  background: linear-gradient(180deg, rgba(10,10,10,0.95) 0%, rgba(10,10,10,1) 100%);
}
.screen-content::-webkit-scrollbar{display:none}

/* ROOM ITEMS */
.room-item{
  background:rgba(28,28,30,0.8);
  backdrop-filter: blur(20px);
  border:1px solid rgba(44,44,46,0.6);
  border-radius:var(--border-radius);
  padding:var(--spacing-lg);
  margin-bottom:var(--spacing-md);
  display:flex;
  align-items:center;
  justify-content:space-between;
  box-shadow:0 4px 16px rgba(0,0,0,0.2);
  transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0);
  animation: fade-in-up 0.6s cubic-bezier(0.4, 0, 0.2, 1) both;
}
.room-item:nth-child(1) { animation-delay: 0.1s; }
.room-item:nth-child(2) { animation-delay: 0.15s; }
.room-item:nth-child(3) { animation-delay: 0.2s; }

.room-item:hover{
  transform: translateY(-2px);
  box-shadow:0 8px 32px rgba(0,0,0,0.3);
  border-color: rgba(99,102,241,0.3);
}
.room-item:active{
  opacity:0.9;
  transform:scale(0.98);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}
.room-name{
  font-size:var(--spacing-lg);
  font-weight:500;
  color:#ffffff;
  flex:1;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.room-icon{
  font-size:18px;
  margin-right:var(--spacing-md);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
}
.delete-room{
  background:rgba(239,68,68,0.1);
  backdrop-filter: blur(10px);
  border:1px solid rgba(239,68,68,0.2);
  color:#ef4444;
  font-size:14px;
  cursor:pointer;
  padding:var(--spacing-xs);
  border-radius:var(--spacing-xs);
  font-weight:500;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0);
}
.delete-room:hover{
  background:rgba(239,68,68,0.2);
  border-color:rgba(239,68,68,0.4);
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(239,68,68,0.3);
}
.delete-room:active{
  opacity:0.7;
  transform:scale(0.95);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.add-room-fab{
  position:fixed;
  bottom:var(--spacing-2xl);
  right:var(--spacing-2xl);
  width:56px;
  height:56px;
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  border:none;
  border-radius:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:50;
  font-size:var(--spacing-xl);
  color:white;
  transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:0 8px 32px rgba(99,102,241,0.4);
  transform: translateZ(0);
  backdrop-filter: blur(20px);
}
.add-room-fab:hover{
  transform: scale(1.1) translateY(-2px);
  box-shadow:0 16px 48px rgba(99,102,241,0.5);
  animation: gentle-pulse 2s infinite;
}
.add-room-fab:active{
  opacity:0.9;
  transform:scale(1.05);
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

/* PROFILE */
.profile-section{
  background:#1c1c1e;
  border:1px solid #2c2c2e;
  margin-bottom:var(--spacing-lg);
  border-radius:var(--border-radius);
  padding:var(--spacing-xl);
  box-shadow:0 2px var(--spacing-sm) rgba(0,0,0,0.4);
}
.profile-avatar{
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
}
.avatar-circle{
  width:64px;
  height:64px;
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  border-radius:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:var(--spacing-2xl);
  font-weight:600;
  margin-bottom:var(--spacing-md);
  box-shadow:0 var(--spacing-xs) var(--spacing-md) rgba(99,102,241,0.3);
}
.profile-name{
  font-size:18px;
  font-weight:600;
  color:#ffffff;
  margin-bottom:var(--spacing-sm);
}
.edit-name-btn{
  background:none;
  border:none;
  color:#6366f1;
  font-size:14px;
  cursor:pointer;
  padding:var(--spacing-xs) var(--spacing-md);
  border-radius:var(--spacing-xs);
  font-weight:500;
  transition:all 0.2s ease;
}
.edit-name-btn:active{opacity:0.6;background:rgba(99,102,241,0.2)}

.profile-menu{
  display:flex;
  flex-direction:column;
  gap:var(--spacing-md);
}
.profile-menu-btn{
  width:100%;
  background:#1c1c1e;
  border:1px solid #2c2c2e;
  border-radius:var(--border-radius);
  padding:var(--spacing-lg);
  display:flex;
  align-items:center;
  cursor:pointer;
  box-shadow:0 2px var(--spacing-sm) rgba(0,0,0,0.4);
  transition:all 0.2s ease;
  text-align:left;
}
.profile-menu-btn:active{opacity:0.8;transform:scale(0.98)}
.menu-btn-icon{
  font-size:var(--spacing-xl);
  margin-right:var(--spacing-md);
  width:28px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.menu-btn-text{flex:1}
.menu-btn-title{
  font-size:var(--spacing-lg);
  font-weight:600;
  color:#ffffff;
  margin-bottom:2px;
}
.menu-btn-desc{
  font-size:var(--spacing-md);
  color:#8e8e93;
}
.menu-btn-arrow{
  font-size:var(--spacing-lg);
  color:#6b7280;
}

/* POPUP */
.popup{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.8);
  z-index:300;
  display:none;
  align-items:center;
  justify-content:center;
  opacity:0;
  transition:opacity 0.3s ease;
}
.popup.show{
  display:flex;
  opacity:1;
}
.popup-content{
  background:#1c1c1e;
  border:1px solid #2c2c2e;
  border-radius:var(--border-radius);
  padding:var(--spacing-xl);
  margin:var(--spacing-xl);
  max-width:280px;
  width:100%;
  box-shadow:0 var(--spacing-sm) var(--spacing-3xl) rgba(0,0,0,0.6);
  text-align:center;
}
.popup-title{
  font-size:var(--spacing-lg);
  font-weight:600;
  color:#ffffff;
  margin-bottom:var(--spacing-sm);
}
.popup-message{
  font-size:14px;
  color:#8e8e93;
  margin-bottom:var(--spacing-lg);
  line-height:1.4;
}
.popup-buttons{
  display:flex;
  gap:var(--spacing-sm);
}
.popup-btn{
  flex:1;
  border:none;
  border-radius:var(--spacing-sm);
  padding:var(--spacing-md);
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  transition:all 0.2s ease;
}
.popup-btn:active{opacity:0.8;transform:scale(0.95)}
.popup-btn.cancel{
  background:#2c2c2e;
  color:#ffffff;
}
.popup-btn.confirm{
  background:#6366f1;
  color:white;
}
.popup-btn.danger{
  background:#ef4444;
  color:white;
}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <button class="profile-btn" onclick="showProfile()">–ü</button>
    <div class="date-nav">
      <button class="nav-arrow" onclick="changeDay(-1)">‚Äπ</button>
      <div class="date-content" onclick="showDatePicker()">
        <div class="date-title" id="dayTitle">–°–µ–≥–æ–¥–Ω—è</div>
        <div class="date-subtitle" id="daySubtitle">–ü–Ω, 27 —è–Ω–≤.</div>
      </div>
      <button class="nav-arrow" onclick="changeDay(1)">‚Ä∫</button>
    </div>
    <button class="rooms-btn" onclick="showRooms()">üè†</button>
  </div>
  
  <div class="content">
    <div class="progress-container" id="progressContainer">
      <div class="progress-info">
        <div class="progress-label" id="progressLabel">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è</div>
        <div class="progress-stats" id="progressStats">0/0</div>
      </div>
      <div class="progress-circle-container">
        <div class="progress-circle" id="progressCircle">
          <div class="progress-circle-inner">
            <div class="progress-percentage" id="progressPercentage">0%</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="empty" id="empty">
      <h2>–ü–ª–∞–Ω–æ–≤ –Ω–µ—Ç</h2>
      <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</p>
      <button class="btn" onclick="showAdd()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
    </div>
    
    <div class="plans-container" id="plansContainer" style="display:none">
      <div class="plans" id="plans"></div>
      <div class="add-task-section">
        <button class="add-task-btn" onclick="showAdd()">
          <span class="add-icon">+</span>
          –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ADD PLAN MODAL -->
<div class="modal" id="addModal">
  <div class="modal-header">
    <button class="header-btn" onclick="hideAdd()">–û—Ç–º–µ–Ω–∞</button>
    <div class="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</div>
    <button class="header-btn" onclick="savePlan()">–ì–æ—Ç–æ–≤–æ</button>
  </div>
  <div class="modal-content">
    <div class="form-group">
      <label class="label">–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ</label>
      <input class="input" id="planTitle" placeholder="–ß—Ç–æ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å?" autofocus>
    </div>
    <div class="form-group">
      <label class="label">–î–∞—Ç–∞</label>
      <input type="date" class="input" id="planDate">
    </div>
    <div class="form-group">
      <label class="label">–ö–æ–º–Ω–∞—Ç–∞</label>
      <div class="select-wrapper">
        <select class="select" id="planRoom">
          <option value="">–ë–µ–∑ –∫–æ–º–Ω–∞—Ç—ã</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- CALENDAR -->
<div class="calendar" id="calendar" onclick="hideCalendar()">
  <div class="calendar-content" onclick="event.stopPropagation()">
    <div class="calendar-header">
      <button class="calendar-nav" onclick="changeCalendarMonth(-1)">‚Äπ</button>
      <div class="calendar-title" id="calendarTitle">–Ø–Ω–≤–∞—Ä—å 2025</div>
      <button class="calendar-nav" onclick="changeCalendarMonth(1)">‚Ä∫</button>
    </div>
    <div class="weekdays">
      <div class="weekday">–ü–Ω</div>
      <div class="weekday">–í—Ç</div>
      <div class="weekday">–°—Ä</div>
      <div class="weekday">–ß—Ç</div>
      <div class="weekday">–ü—Ç</div>
      <div class="weekday">–°–±</div>
      <div class="weekday">–í—Å</div>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
  </div>
</div>

<!-- EDIT PLAN SCREEN -->
<div class="screen" id="editPlanScreen">
  <div class="screen-header">
    <button class="header-btn" onclick="hideEditPlan()">–ù–∞–∑–∞–¥</button>
    <div class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É</div>
    <div></div>
  </div>
  <div class="screen-content">
    <div class="form-group">
      <input class="input edit-plan-input" id="editPlanTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
    </div>
    
    <div class="form-group">
      <label class="label">–î–∞—Ç–∞</label>
      <div class="form-row" onclick="showEditDatePicker()">
        <span id="editPlanDate">26 —è–Ω–≤. 2026–≥.</span>
      </div>
    </div>
    
    <div class="form-group">
      <label class="label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</label>
      <div class="form-row">
        <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</span>
        <div class="toggle" id="notificationToggle" onclick="toggleNotification()">
          <div class="toggle-slider"></div>
        </div>
      </div>
    </div>
    
    <div class="form-group">
      <label class="label">–í–∞–∂–Ω–∞—è</label>
      <div class="form-row">
        <span>–í–∞–∂–Ω–∞—è</span>
        <div class="toggle" id="importantToggle" onclick="toggleImportant()">
          <div class="toggle-slider"></div>
        </div>
      </div>
    </div>
    
    <div class="premium-notice">
      <div class="premium-icon">‚≠ê</div>
      <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø–æ–º–µ—Ç–∫–∞ ¬´–í–∞–∂–Ω–∞—è¬ª –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π </span>
      <span class="premium-link">–ü—Ä–µ–º–∏—É–º –¢—Ä–µ–∫–µ—Ä</span>
    </div>
    
    <button class="delete-btn" onclick="deletePlanFromEdit()">
      –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É
    </button>
  </div>
  
  <div class="screen-footer">
    <button class="save-btn" onclick="savePlanEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<!-- MENU OVERLAY (simplified) -->
<div class="overlay" id="overlay" onclick="hideMenu()">
  <div class="menu" id="menu" onclick="event.stopPropagation()">
    <button class="menu-btn" onclick="editPlan()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
    <button class="menu-btn del" onclick="deletePlan()">–£–¥–∞–ª–∏—Ç—å</button>
  </div>
</div>


<!-- ROOMS SCREEN -->
<div class="screen" id="roomsScreen">
  <div class="screen-header">
    <button class="header-btn" onclick="hideRooms()">–ù–∞–∑–∞–¥</button>
    <div class="modal-title">–ö–æ–º–Ω–∞—Ç—ã</div>
    <button class="header-btn" onclick="hideRooms()">–ì–æ—Ç–æ–≤–æ</button>
  </div>
  <div class="screen-content" id="roomsList"></div>
  <button class="add-room-fab" onclick="showAddRoom()">+</button>
</div>

<!-- PROFILE SCREEN -->
<div class="screen" id="profileScreen">
  <div class="screen-header">
    <button class="header-btn" onclick="hideProfile()">–ù–∞–∑–∞–¥</button>
    <div class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
    <button class="header-btn" onclick="hideProfile()">–ì–æ—Ç–æ–≤–æ</button>
  </div>
  <div class="screen-content">
    <div class="profile-section">
      <div class="profile-avatar">
        <div class="avatar-circle">–ü</div>
        <div class="profile-name" id="profileName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
        <button class="edit-name-btn" onclick="editName()">–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>
      </div>
    </div>
    
    <div class="profile-menu">
      <button class="profile-menu-btn" onclick="showAccount()">
        <div class="menu-btn-icon">üë§</div>
        <div class="menu-btn-text">
          <div class="menu-btn-title">–ê–∫–∫–∞—É–Ω—Ç</div>
          <div class="menu-btn-desc">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥–ø–∏—Å–∫–∞</div>
        </div>
        <div class="menu-btn-arrow">‚Ä∫</div>
      </button>
      
      <button class="profile-menu-btn" onclick="showSettings()">
        <div class="menu-btn-icon">‚öôÔ∏è</div>
        <div class="menu-btn-text">
          <div class="menu-btn-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
          <div class="menu-btn-desc">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</div>
        </div>
        <div class="menu-btn-arrow">‚Ä∫</div>
      </button>
      
      <button class="profile-menu-btn" onclick="showSupport()">
        <div class="menu-btn-icon">üí¨</div>
        <div class="menu-btn-text">
          <div class="menu-btn-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
          <div class="menu-btn-desc">–ü–æ–º–æ—â—å –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</div>
        </div>
        <div class="menu-btn-arrow">‚Ä∫</div>
      </button>
    </div>
  </div>
</div>

<!-- POPUP -->
<div class="popup" id="popup">
  <div class="popup-content">
    <div class="popup-title" id="popupTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div>
    <div class="popup-message" id="popupMessage">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
    <div class="popup-buttons" id="popupButtons"></div>
  </div>
</div>

<script>
'use strict';

// TELEGRAM WEB APP INIT
const tg = window.Telegram?.WebApp;
if (tg) {
  tg.ready();
  tg.expand();
}

// STATE
let currentDate = new Date();
let plans = [];
let rooms = [];
let selectedPlanId = null;
let calendarDate = new Date();

// UTILS
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function formatDate(date) {
  const today = new Date();
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);
  const yesterday = new Date(today);
  yesterday.setDate(yesterday.getDate() - 1);

  if (date.toDateString() === today.toDateString()) return '–°–µ–≥–æ–¥–Ω—è';
  if (date.toDateString() === tomorrow.toDateString()) return '–ó–∞–≤—Ç—Ä–∞';
  if (date.toDateString() === yesterday.toDateString()) return '–í—á–µ—Ä–∞';
  
  return date.toLocaleDateString('ru-RU', { weekday: 'long' });
}

function formatDateSubtitle(date) {
  const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
  const months = ['—è–Ω–≤', '—Ñ–µ–≤', '–º–∞—Ä', '–∞–ø—Ä', '–º–∞–π', '–∏—é–Ω', '–∏—é–ª', '–∞–≤–≥', '—Å–µ–Ω', '–æ–∫—Ç', '–Ω–æ—è', '–¥–µ–∫'];
  return `${days[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]}.`;
}

function getPlansForDate(date) {
  const dateStr = date.toDateString();
  return plans.filter(p => new Date(p.date).toDateString() === dateStr);
}

// STORAGE
function loadData() {
  try {
    plans = JSON.parse(localStorage.getItem('planner_plans') || '[]');
    rooms = JSON.parse(localStorage.getItem('planner_rooms') || '[]');
  } catch (e) {
    console.error('Error loading data:', e);
    plans = [];
    rooms = [];
  }
}

function savePlans() {
  try {
    localStorage.setItem('planner_plans', JSON.stringify(plans));
  } catch (e) {
    console.error('Error saving plans:', e);
  }
}

function saveRooms() {
  try {
    localStorage.setItem('planner_rooms', JSON.stringify(rooms));
  } catch (e) {
    console.error('Error saving rooms:', e);
  }
}

// RENDER
function render() {
  const todayPlans = getPlansForDate(currentDate);
  
  // Update date display
  document.getElementById('dayTitle').textContent = formatDate(currentDate);
  document.getElementById('daySubtitle').textContent = formatDateSubtitle(currentDate);
  
  // Update progress
  const completedCount = todayPlans.filter(p => p.completed).length;
  const totalCount = todayPlans.length;
  updateProgress();
  
  // Show/hide elements
  const empty = document.getElementById('empty');
  const plansContainer = document.getElementById('plansContainer');
  
  if (todayPlans.length === 0) {
    empty.style.display = 'flex';
    plansContainer.style.display = 'none';
  } else {
    empty.style.display = 'none';
    plansContainer.style.display = 'flex';
    
    // Render plans
    const plansEl = document.getElementById('plans');
    let html = '';
    todayPlans.forEach(plan => {
      html += `
        <div class="plan ${plan.completed ? 'completed' : ''}">
          <div class="checkbox ${plan.completed ? 'checked' : ''}" onclick="toggleComplete('${plan.id}', event)"></div>
          <div class="plan-content" onclick="showPlanMenu('${plan.id}')">
            <div class="plan-title">${escapeHtml(plan.title)}</div>
            ${plan.room ? `<div class="room">${escapeHtml(plan.room)}</div>` : ''}
          </div>
        </div>
      `;
    });
    plansEl.innerHTML = html;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
    setTimeout(() => {
      todayPlans.forEach(plan => {
        if (plan.completed) {
          const planElements = plansEl.querySelectorAll('.plan.completed');
          planElements.forEach(planElement => {
            const planTitle = planElement.querySelector('.plan-title');
            if (planTitle && planTitle.textContent.trim() === plan.title) {
              const textWidth = getTextWidth(planTitle.textContent, planTitle);
              planTitle.style.setProperty('--text-width', textWidth + 'px');
            }
          });
        }
      });
    }, 50);
  }
}

function updateRoomsSelect() {
  const select = document.getElementById('planRoom');
  select.innerHTML = '<option value="">–ë–µ–∑ –∫–æ–º–Ω–∞—Ç—ã</option>';
  rooms.forEach(room => {
    const option = document.createElement('option');
    option.value = room;
    option.textContent = room;
    select.appendChild(option);
  });
}

function renderRooms() {
  const roomsList = document.getElementById('roomsList');
  const roomIcons = ['üè†', 'üõèÔ∏è', 'üç≥', 'üõÅ', 'üíº', 'üèÉ', 'üìö', 'üéÆ', 'üåø', 'üîß'];
  
  let html = '';
  rooms.forEach((room, index) => {
    const icon = roomIcons[index % roomIcons.length];
    html += `
      <div class="room-item">
        <div class="room-icon">${icon}</div>
        <div class="room-name">${escapeHtml(room)}</div>
        <button class="delete-room" onclick="deleteRoom('${escapeHtml(room)}')">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    `;
  });
  roomsList.innerHTML = html;
}

// NAVIGATION
function changeDay(direction) {
  currentDate.setDate(currentDate.getDate() + direction);
  render();
}

// MODALS & SCREENS
function showAdd() {
  document.getElementById('addModal').classList.add('show');
  document.getElementById('planDate').value = currentDate.toISOString().split('T')[0];
  updateRoomsSelect();
  setTimeout(() => {
    document.getElementById('planTitle').focus();
  }, 300);
}

function hideAdd() {
  document.getElementById('addModal').classList.remove('show');
  clearForm();
  selectedPlanId = null;
}

function showRooms() {
  document.getElementById('roomsScreen').classList.add('show');
  document.querySelector('.header').style.display = 'none';
  renderRooms();
}

function hideRooms() {
  document.getElementById('roomsScreen').classList.remove('show');
  document.querySelector('.header').style.display = 'flex';
}

function showProfile() {
  document.getElementById('profileScreen').classList.add('show');
  document.querySelector('.header').style.display = 'none';
  loadProfileData();
}

function hideProfile() {
  document.getElementById('profileScreen').classList.remove('show');
  document.querySelector('.header').style.display = 'flex';
}

// PLANS
function savePlan() {
  const title = document.getElementById('planTitle').value.trim();
  if (!title) return;
  
  const room = document.getElementById('planRoom').value;
  const date = document.getElementById('planDate').value || currentDate.toISOString().split('T')[0];
  
  const plan = {
    id: selectedPlanId || Date.now().toString(),
    title: title,
    date: date,
    room: room || null,
    completed: false
  };
  
  if (selectedPlanId) {
    const index = plans.findIndex(p => p.id === selectedPlanId);
    if (index !== -1) {
      plans[index] = plan;
    }
  } else {
    plans.push(plan);
  }
  
  savePlans();
  hideAdd();
  currentDate = new Date(date);
  render();
}

function clearForm() {
  document.getElementById('planTitle').value = '';
  document.getElementById('planDate').value = '';
  document.getElementById('planRoom').value = '';
}

function showPlanMenu(id) {
  selectedPlanId = id;
  document.getElementById('overlay').classList.add('show');
}

function editPlan() {
  const plan = plans.find(p => p.id === selectedPlanId);
  if (!plan) return;
  
  // Fill edit form
  document.getElementById('editPlanTitle').value = plan.title;
  
  // Format date
  const date = new Date(plan.date);
  const months = ['—è–Ω–≤', '—Ñ–µ–≤', '–º–∞—Ä', '–∞–ø—Ä', '–º–∞–π', '–∏—é–Ω', '–∏—é–ª', '–∞–≤–≥', '—Å–µ–Ω', '–æ–∫—Ç', '–Ω–æ—è', '–¥–µ–∫'];
  const formattedDate = `${date.getDate()} ${months[date.getMonth()]}. ${date.getFullYear()}–≥.`;
  document.getElementById('editPlanDate').textContent = formattedDate;
  
  // Reset toggles (premium features disabled)
  document.getElementById('notificationToggle').classList.remove('active');
  document.getElementById('importantToggle').classList.remove('active');
  
  hideMenu();
  showEditPlan();
}

function showEditPlan() {
  // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–∞—Ç—ã
  window.editPlanNewDate = null;
  
  document.getElementById('editPlanScreen').classList.add('show');
  document.querySelector('.header').style.display = 'none';
}

function hideEditPlan() {
  document.getElementById('editPlanScreen').classList.remove('show');
  document.querySelector('.header').style.display = 'flex';
}

function toggleNotification() {
  // Premium feature - show popup
  showPopup(
    '–ü—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è',
    '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –ü—Ä–µ–º–∏—É–º –¢—Ä–µ–∫–µ—Ä',
    [{ text: 'OK', type: 'confirm', action: hidePopup }]
  );
}

function toggleImportant() {
  // Premium feature - show popup
  showPopup(
    '–ü—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è', 
    '–ü–æ–º–µ—Ç–∫–∞ ¬´–í–∞–∂–Ω–∞—è¬ª –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –ü—Ä–µ–º–∏—É–º –¢—Ä–µ–∫–µ—Ä',
    [{ text: 'OK', type: 'confirm', action: hidePopup }]
  );
}

function showEditDatePicker() {
  showPopup(
    '–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞—Ç—É',
    '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é –¥–∞—Ç—É –¥–ª—è –∑–∞–¥–∞—á–∏',
    [
      { text: '–û—Ç–º–µ–Ω–∞', type: 'cancel', action: hidePopup },
      { text: '–°–µ–≥–æ–¥–Ω—è', type: 'confirm', action: () => setEditDate(0) },
      { text: '–ó–∞–≤—Ç—Ä–∞', type: 'confirm', action: () => setEditDate(1) }
    ]
  );
}

function setEditDate(daysOffset) {
  const newDate = new Date();
  newDate.setDate(newDate.getDate() + daysOffset);
  
  const months = ['—è–Ω–≤', '—Ñ–µ–≤', '–º–∞—Ä', '–∞–ø—Ä', '–º–∞–π', '–∏—é–Ω', '–∏—é–ª', '–∞–≤–≥', '—Å–µ–Ω', '–æ–∫—Ç', '–Ω–æ—è', '–¥–µ–∫'];
  const formattedDate = `${newDate.getDate()} ${months[newDate.getMonth()]}. ${newDate.getFullYear()}–≥.`;
  document.getElementById('editPlanDate').textContent = formattedDate;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—É—é –¥–∞—Ç—É –≤ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
  window.editPlanNewDate = newDate.toISOString().split('T')[0];
  
  hidePopup();
}

function savePlanEdit() {
  const plan = plans.find(p => p.id === selectedPlanId);
  if (!plan) return;
  
  const newTitle = document.getElementById('editPlanTitle').value.trim();
  if (!newTitle) return;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–∞—Ç—É –∏–∑–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –Ω–æ–≤–∞—è
  plan.title = newTitle;
  
  // –ï—Å–ª–∏ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –Ω–æ–≤–∞—è –¥–∞—Ç–∞ —á–µ—Ä–µ–∑ setEditDate
  if (window.editPlanNewDate) {
    plan.date = window.editPlanNewDate;
    window.editPlanNewDate = null; // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
  }
  
  savePlans();
  render();
  hideEditPlan();
}

function deletePlanFromEdit() {
  showPopup(
    '–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?',
    '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.',
    [
      { text: '–û—Ç–º–µ–Ω–∞', type: 'cancel', action: hidePopup },
      { text: '–£–¥–∞–ª–∏—Ç—å', type: 'danger', action: confirmDeleteFromEdit }
    ]
  );
}

function confirmDeleteFromEdit() {
  plans = plans.filter(p => p.id !== selectedPlanId);
  savePlans();
  hidePopup();
  hideEditPlan();
  render();
}

function hideMenu() {
  document.getElementById('overlay').classList.remove('show');
  selectedPlanId = null;
}

function editPlan() {
  const plan = plans.find(p => p.id === selectedPlanId);
  if (!plan) return;
  
  document.getElementById('planTitle').value = plan.title;
  document.getElementById('planDate').value = plan.date;
  document.getElementById('planRoom').value = plan.room || '';
  
  hideMenu();
  showAdd();
}

function deletePlan() {
  if (!selectedPlanId) return;
  
  showPopup(
    '–£–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω?',
    '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.',
    [
      { text: '–û—Ç–º–µ–Ω–∞', type: 'cancel', action: hidePopup },
      { text: '–£–¥–∞–ª–∏—Ç—å', type: 'danger', action: confirmDeletePlan }
    ]
  );
}

function confirmDeletePlan() {
  plans = plans.filter(p => p.id !== selectedPlanId);
  savePlans();
  hidePopup();
  hideMenu();
  render();
}

function toggleComplete(id, event) {
  event.stopPropagation();
  const plan = plans.find(p => p.id === id);
  if (!plan) return;
  
  const planElement = event.target.closest('.plan');
  const checkbox = event.target;
  const planTitle = planElement.querySelector('.plan-title');
  
  if (plan.completed) {
    // –£–±–∏—Ä–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ - –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
    plan.completed = false;
    planElement.classList.remove('completed', 'animate-strike');
    checkbox.classList.remove('checked');
  } else {
    // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ - —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    plan.completed = true;
    
    // –ò–∑–º–µ—Ä—è–µ–º —Ç–æ—á–Ω—É—é —à–∏—Ä–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
    const textWidth = getTextWidth(planTitle.textContent, planTitle);
    planTitle.style.setProperty('--text-width', textWidth + 'px');
    
    // –°–Ω–∞—á–∞–ª–∞ –∞–Ω–∏–º–∏—Ä—É–µ–º —á–µ–∫–±–æ–∫—Å
    checkbox.classList.add('checked');
    
    // –ó–∞—Ç–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
    setTimeout(() => {
      planElement.classList.add('completed', 'animate-strike');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –≤–∏–±—Ä–∞—Ü–∏—é –¥–ª—è —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
    }, 150);
  }
  
  savePlans();
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–µ—Å—Å, –Ω–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≤–µ—Å—å —Å–ø–∏—Å–æ–∫
  updateProgress();
}

function getTextWidth(text, element) {
  // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —à–∏—Ä–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');
  
  // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞
  const styles = window.getComputedStyle(element);
  context.font = `${styles.fontWeight} ${styles.fontSize} ${styles.fontFamily}`;
  
  // –ò–∑–º–µ—Ä—è–µ–º —à–∏—Ä–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
  const metrics = context.measureText(text);
  return metrics.width;
}

function updateProgress() {
  const todayPlans = getPlansForDate(currentDate);
  const completedCount = todayPlans.filter(p => p.completed).length;
  const totalCount = todayPlans.length;
  const progressPercent = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∫—Ä—É–≥–ª—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
  const progressCircle = document.getElementById('progressCircle');
  const progressPercentage = document.getElementById('progressPercentage');
  const progressContainer = document.getElementById('progressContainer');
  const progressLabel = document.getElementById('progressLabel');
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  const angle = (progressPercent / 100) * 360;
  if (progressPercent > 0) {
    progressCircle.style.background = `conic-gradient(
      from 0deg,
      var(--accent-primary) 0deg,
      var(--accent-secondary) ${angle * 0.33}deg,
      var(--accent-soft) ${angle * 0.66}deg,
      var(--accent-primary) ${angle}deg,
      rgba(0, 0, 0, 0.2) ${angle}deg
    )`;
  } else {
    progressCircle.style.background = `conic-gradient(
      from 0deg,
      rgba(0, 0, 0, 0.2) 0deg
    )`;
  }
  
  // –ü–ª–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  const currentPercent = parseInt(progressPercentage.textContent) || 0;
  const targetPercent = Math.round(progressPercent);
  
  if (currentPercent !== targetPercent) {
    animatePercentage(progressPercentage, currentPercent, targetPercent);
  }
  
  document.getElementById('progressStats').textContent = `${completedCount}/${totalCount}`;
  
  // Update progress label and animations based on completion
  if (totalCount === 0) {
    progressLabel.textContent = '–ü–ª–∞–Ω–æ–≤ –Ω–µ—Ç';
    removeCompletionAnimations();
  } else if (completedCount === totalCount && totalCount > 0) {
    progressLabel.textContent = '–î–µ–Ω—å –∑–∞–≤–µ—Ä—à—ë–Ω! üéâ';
    addCompletionAnimations();
  } else {
    progressLabel.textContent = '–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è';
    removeCompletionAnimations();
  }
}

function animatePercentage(element, from, to) {
  const duration = 600;
  const steps = Math.abs(to - from);
  if (steps === 0) return;
  
  const stepDuration = duration / steps;
  const increment = to > from ? 1 : -1;
  let current = from;
  
  const timer = setInterval(() => {
    current += increment;
    element.textContent = current + '%';
    
    if (current === to) {
      clearInterval(timer);
    }
  }, stepDuration);
}

// –£–±–∏—Ä–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é animateNumber, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º—ã
function addCompletionAnimations() {
  const progressContainer = document.getElementById('progressContainer');
  const progressCircle = document.getElementById('progressCircle');
  const progressPercentage = document.getElementById('progressPercentage');
  
  progressContainer.classList.add('completed');
  progressCircle.classList.add('completed');
  progressPercentage.classList.add('completed');
}

function removeCompletionAnimations() {
  const progressContainer = document.getElementById('progressContainer');
  const progressCircle = document.getElementById('progressCircle');
  const progressPercentage = document.getElementById('progressPercentage');
  
  progressContainer.classList.remove('completed');
  progressCircle.classList.remove('completed');
  progressPercentage.classList.remove('completed');
}

function celebrateCompletion() {
  // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –Ω–µ –Ω—É–∂–Ω–∞, —Ç–∞–∫ –∫–∞–∫ –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è
}

// CALENDAR
function showDatePicker() {
  calendarDate = new Date(currentDate);
  renderCalendar();
  document.getElementById('calendar').classList.add('show');
}

function hideCalendar() {
  document.getElementById('calendar').classList.remove('show');
}

function changeCalendarMonth(direction) {
  calendarDate.setMonth(calendarDate.getMonth() + direction);
  renderCalendar();
}

function selectDate(selectedDate) {
  currentDate = new Date(selectedDate);
  render();
  hideCalendar();
}

function renderCalendar() {
  const year = calendarDate.getFullYear();
  const month = calendarDate.getMonth();
  
  const monthNames = [
    '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
    '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
  ];
  
  document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;
  
  const firstDay = new Date(year, month, 1);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - (firstDay.getDay() || 7) + 1);
  
  const grid = document.getElementById('calendarGrid');
  grid.innerHTML = '';
  
  const today = new Date();
  const selectedDate = new Date(currentDate);
  
  for (let i = 0; i < 42; i++) {
    const currentCalendarDate = new Date(startDate);
    currentCalendarDate.setDate(startDate.getDate() + i);
    
    const button = document.createElement('button');
    button.className = 'calendar-day';
    button.textContent = currentCalendarDate.getDate();
    button.onclick = () => selectDate(currentCalendarDate);
    
    if (currentCalendarDate.getMonth() !== month) {
      button.classList.add('other-month');
    }
    if (currentCalendarDate.toDateString() === today.toDateString()) {
      button.classList.add('today');
    }
    if (currentCalendarDate.toDateString() === selectedDate.toDateString()) {
      button.classList.add('selected');
    }
    
    grid.appendChild(button);
  }
}

// ROOMS
function showAddRoom() {
  showPopup(
    '–ù–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞',
    '',
    [
      { text: '–û—Ç–º–µ–Ω–∞', type: 'cancel', action: hidePopup },
      { text: '–î–æ–±–∞–≤–∏—Ç—å', type: 'confirm', action: addRoom }
    ],
    true
  );
}

function addRoom() {
  const input = document.querySelector('.popup-input');
  const roomName = input.value.trim();
  
  if (!roomName) return;
  
  if (rooms.includes(roomName)) {
    showPopup('–û—à–∏–±–∫–∞', '–ö–æ–º–Ω–∞—Ç–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.', [
      { text: 'OK', type: 'confirm', action: hidePopup }
    ]);
    return;
  }
  
  rooms.push(roomName);
  saveRooms();
  renderRooms();
  updateRoomsSelect();
  hidePopup();
}

function deleteRoom(roomName) {
  showPopup(
    '–£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É?',
    `–ö–æ–º–Ω–∞—Ç–∞ "${roomName}" –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞.`,
    [
      { text: '–û—Ç–º–µ–Ω–∞', type: 'cancel', action: hidePopup },
      { text: '–£–¥–∞–ª–∏—Ç—å', type: 'danger', action: () => confirmDeleteRoom(roomName) }
    ]
  );
}

function confirmDeleteRoom(roomName) {
  rooms = rooms.filter(r => r !== roomName);
  saveRooms();
  renderRooms();
  updateRoomsSelect();
  hidePopup();
}

// PROFILE
function loadProfileData() {
  const userName = localStorage.getItem('planner_userName') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
  document.getElementById('profileName').textContent = userName;
  
  const firstLetter = userName.charAt(0).toUpperCase();
  document.querySelector('.avatar-circle').textContent = firstLetter;
  document.querySelector('.profile-btn').textContent = firstLetter;
}

function editName() {
  showPopup(
    '–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è',
    '',
    [
      { text: '–û—Ç–º–µ–Ω–∞', type: 'cancel', action: hidePopup },
      { text: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å', type: 'confirm', action: saveName }
    ],
    true,
    document.getElementById('profileName').textContent
  );
}

function saveName() {
  const input = document.querySelector('.popup-input');
  const newName = input.value.trim();
  
  if (newName) {
    localStorage.setItem('planner_userName', newName);
    loadProfileData();
  }
  
  hidePopup();
}

function showAccount() {
  showPopup(
    '–ê–∫–∫–∞—É–Ω—Ç',
    `–ü–ª–∞–Ω–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: ${plans.length}\n–ö–æ–º–Ω–∞—Ç —Å–æ–∑–¥–∞–Ω–æ: ${rooms.length}\n–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: 27 —è–Ω–≤–∞—Ä—è 2025\n–ü–æ–¥–ø–∏—Å–∫–∞: –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω`,
    [{ text: 'OK', type: 'confirm', action: hidePopup }]
  );
}

function showSettings() {
  showPopup(
    '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
    '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –í–∫–ª—é—á–µ–Ω—ã\n–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: GMT+3 (–ú–æ—Å–∫–≤–∞)\n–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π\n–¢–µ–º–∞: –°–∏—Å—Ç–µ–º–Ω–∞—è',
    [{ text: 'OK', type: 'confirm', action: hidePopup }]
  );
}

function showSupport() {
  showPopup(
    '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
    '–í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.',
    [
      { text: '–û—Ç–º–µ–Ω–∞', type: 'cancel', action: hidePopup },
      { text: '–ù–∞–ø–∏—Å–∞—Ç—å', type: 'confirm', action: openSupport }
    ]
  );
}

function openSupport() {
  const message = '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –£ –º–µ–Ω—è –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –ü–ª–∞–Ω–µ—Ä v6.0.';
  const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(message)}`;
  window.open(telegramUrl, '_blank');
  hidePopup();
}

// POPUP SYSTEM
function showPopup(title, message, buttons, hasInput = false, inputValue = '') {
  document.getElementById('popupTitle').textContent = title;
  document.getElementById('popupMessage').textContent = message;
  
  const buttonsContainer = document.getElementById('popupButtons');
  buttonsContainer.innerHTML = '';
  
  if (hasInput) {
    const input = document.createElement('input');
    input.className = 'input popup-input';
    input.placeholder = '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...';
    input.value = inputValue;
    input.style.marginBottom = '16px';
    document.querySelector('.popup-content').insertBefore(input, buttonsContainer);
    setTimeout(() => input.focus(), 100);
  }
  
  buttons.forEach(btn => {
    const button = document.createElement('button');
    button.className = `popup-btn ${btn.type}`;
    button.textContent = btn.text;
    button.onclick = btn.action;
    buttonsContainer.appendChild(button);
  });
  
  document.getElementById('popup').classList.add('show');
}

function hidePopup() {
  document.getElementById('popup').classList.remove('show');
  
  // Remove input if exists
  const existingInput = document.querySelector('.popup-input');
  if (existingInput) {
    existingInput.remove();
  }
}

// TELEGRAM INTEGRATION
if (tg) {
  tg.onEvent('backButtonClicked', () => {
    if (document.getElementById('editPlanScreen').classList.contains('show')) {
      hideEditPlan();
    } else if (document.getElementById('roomsScreen').classList.contains('show')) {
      hideRooms();
    } else if (document.getElementById('profileScreen').classList.contains('show')) {
      hideProfile();
    } else if (document.getElementById('addModal').classList.contains('show')) {
      hideAdd();
    } else if (document.getElementById('overlay').classList.contains('show')) {
      hideMenu();
    } else if (document.getElementById('calendar').classList.contains('show')) {
      hideCalendar();
    } else if (document.getElementById('popup').classList.contains('show')) {
      hidePopup();
    } else {
      tg.close();
    }
  });
}

// KEYBOARD EVENTS
document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    const activeElement = document.activeElement;
    if (activeElement && activeElement.classList.contains('popup-input')) {
      e.preventDefault();
      const confirmBtn = document.querySelector('.popup-btn.confirm');
      if (confirmBtn) confirmBtn.click();
    }
  }
  
  if (e.key === 'Escape') {
    if (document.getElementById('popup').classList.contains('show')) {
      hidePopup();
    } else if (document.getElementById('calendar').classList.contains('show')) {
      hideCalendar();
    } else if (document.getElementById('overlay').classList.contains('show')) {
      hideMenu();
    }
  }
});

// TOUCH GESTURES
let startY = 0;
document.addEventListener('touchstart', (e) => {
  startY = e.touches[0].clientY;
});

document.addEventListener('touchend', (e) => {
  const endY = e.changedTouches[0].clientY;
  const diff = endY - startY;
  
  if (diff > 80 && window.scrollY === 0) {
    showAdd();
  }
});

// INIT
document.addEventListener('DOMContentLoaded', () => {
  loadData();
  loadProfileData();
  render();
  
  console.log('üöÄ –ü–ª–∞–Ω–µ—Ä v6.10.1 Fix Progress Numbers –∑–∞–≥—Ä—É–∂–µ–Ω');
});
</script>
</body>
</html>