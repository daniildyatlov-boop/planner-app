<!DOCTYPE html>
<html>
<head>
    <title>Debug Storage</title>
</head>
<body>
    <h1>Debug localStorage</h1>
    <button onclick="checkStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
    <button onclick="clearMigration()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–ª–∞–≥ –º–∏–≥—Ä–∞—Ü–∏–∏</button>
    <button onclick="forceCleanup()">üö® –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –û–ß–ò–°–¢–ö–ê</button>
    <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
    <pre id="output"></pre>

    <script>
        function log(message) {
            document.getElementById('output').innerHTML += message + '\n';
            console.log(message);
        }

        function checkStorage() {
            document.getElementById('output').innerHTML = '';
            log('=== –ü–†–û–í–ï–†–ö–ê localStorage ===');
            
            const plans = localStorage.getItem('planner_plans');
            const sections = localStorage.getItem('planner_sections');
            const migration = localStorage.getItem('planner_migration_routine_cleanup');
            const deletedIds = localStorage.getItem('planner_deleted_task_ids');
            
            log('üìã planner_plans: ' + (plans ? JSON.parse(plans).length + ' –∑–∞–¥–∞—á' : '–ù–ï–¢'));
            if (plans) {
                const parsedPlans = JSON.parse(plans);
                parsedPlans.forEach(plan => {
                    const isRoutine = plan.sectionId != null || 
                                     plan.createdFromSection === true || 
                                     (plan.id && plan.id.toString().startsWith('section:'));
                    log(`  - ${plan.title} (ID: ${plan.id}) ${isRoutine ? 'üîÑ –†–£–¢–ò–ù–ù–ê–Ø' : '‚úã –†–£–ß–ù–ê–Ø'}`);
                });
            }
            
            log('üìÇ planner_sections: ' + (sections ? JSON.parse(sections).length + ' —Ä–∞–∑–¥–µ–ª–æ–≤' : '–ù–ï–¢'));
            log('üßπ –§–ª–∞–≥ –º–∏–≥—Ä–∞—Ü–∏–∏: ' + (migration || '–ù–ï–¢'));
            log('üóëÔ∏è –£–¥–∞–ª–µ–Ω–Ω—ã–µ ID: ' + (deletedIds ? JSON.parse(deletedIds).length + ' ID' : '–ù–ï–¢'));
            
            log('=== –ö–û–ù–ï–¶ –ü–†–û–í–ï–†–ö–ò ===');
        }

        function clearMigration() {
            localStorage.removeItem('planner_migration_routine_cleanup');
            log('üßπ –§–ª–∞–≥ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–±—Ä–æ—à–µ–Ω');
        }

        function forceCleanup() {
            log('üö® –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –ù–ê–ß–ê–¢–ê...');
            
            // –£–¥–∞–ª—è–µ–º –í–°–ï –∫–ª—é—á–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–ª–∞–Ω–∞–º–∏ –∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏
            const keysToRemove = [
                'planner_plans',
                'planner_sections', 
                'planner_teams',
                'planner_rooms',
                'plans',
                'teams',
                'rooms',
                'sections',
                'planner_migration_routine_cleanup'
            ];
            
            keysToRemove.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω –∫–ª—é—á: ${key}`);
                }
            });
            
            log('‚úÖ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê');
            log('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π');
        }

        function clearAll() {
            localStorage.clear();
            log('üóëÔ∏è –í–µ—Å—å localStorage –æ—á–∏—â–µ–Ω');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = checkStorage;
    </script>
</body>
</html>