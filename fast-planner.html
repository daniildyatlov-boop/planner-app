<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>–ü–ª–∞–Ω–µ—Ä</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f2f2f7;color:var(--tg-theme-text-color,#000);line-height:1.4;overflow-x:hidden;min-height:100vh}
.app{min-height:100vh;display:flex;flex-direction:column}
.header{padding:16px 20px;background:#f2f2f7;display:flex;align-items:center;justify-content:space-between}
.teams-header{padding:0 0 16px 0;text-align:right}
.teams-link{background:none;border:none;color:#007aff;font-size:15px;cursor:pointer;padding:8px 0}
.teams-link:active{opacity:0.6}
.date-nav{display:flex;align-items:center;gap:8px;background:white;border-radius:16px;padding:6px 12px;box-shadow:0 1px 4px rgba(0,0,0,0.08)}
.date-title{font-size:15px;font-weight:600;color:#000;margin:0 6px}
.date-subtitle{font-size:11px;color:#8e8e93}
.profile-btn{width:32px;height:32px;background:#007aff;border:none;border-radius:16px;display:flex;align-items:center;justify-content:center;color:white;font-size:14px;font-weight:600;cursor:pointer}
.profile-btn:active{opacity:0.8}
.rooms-btn{width:32px;height:32px;background:white;border:none;border-radius:16px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,0.08);font-size:16px}
.rooms-btn:active{opacity:0.8}
.nav{background:white;border:none;font-size:18px;color:#000;cursor:pointer;width:32px;height:32px;border-radius:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 4px rgba(0,0,0,0.1)}
.nav:active{opacity:0.6}
.teams-btn{background:none;border:none;font-size:24px;cursor:pointer;padding:0}
.teams-btn:active{opacity:0.6}
.title{font-size:17px;font-weight:600;flex:1;text-align:center;display:none}
.content{flex:1;padding:20px;display:flex;flex-direction:column;padding-bottom:20px}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;text-align:center;padding:20px 20px 20px}
.empty h2{font-size:20px;font-weight:500;margin-bottom:8px}
.empty p{font-size:15px;color:var(--tg-theme-hint-color,#8e8e93);margin-bottom:32px}
.btn{background:var(--tg-theme-button-color,#007aff);color:var(--tg-theme-button-text-color,#fff);border:none;border-radius:8px;padding:12px 24px;font-size:17px;font-weight:500;cursor:pointer}
.btn:active{opacity:0.8}
.plans{flex:0}
.group{margin-bottom:16px}
.group-title{font-size:13px;color:var(--tg-theme-hint-color,#8e8e93);text-transform:uppercase;letter-spacing:0.5px;font-weight:600;margin-bottom:8px;padding:0 4px}
.plan{background:var(--tg-theme-secondary-bg-color,#f8f9fa);border-radius:8px;padding:16px;margin-bottom:6px;display:flex;align-items:center;cursor:pointer}
.plan:active{opacity:0.8}
.time{font-size:15px;color:var(--tg-theme-link-color,#007aff);font-weight:500;min-width:50px;margin-right:12px}
.plan-content{flex:1}
.plan-title{font-size:17px;margin-bottom:2px}
.room{font-size:13px;color:var(--tg-theme-hint-color,#8e8e93)}
.add{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--tg-theme-bg-color,#fff);z-index:100;display:none;flex-direction:column}
.add.show{display:flex}
.add-header{padding:20px 20px 20px;background:var(--tg-theme-bg-color,#fff);border-bottom:0.5px solid var(--tg-theme-hint-color,rgba(0,0,0,0.1));display:flex;align-items:center;justify-content:space-between}
.header-btn{background:none;border:none;font-size:17px;color:var(--tg-theme-link-color,#007aff);cursor:pointer;padding:8px}
.header-btn:active{opacity:0.6}
.add-content{flex:1;padding:20px}
.form-group{margin-bottom:20px}
.label{font-size:13px;color:var(--tg-theme-hint-color,#8e8e93);text-transform:uppercase;letter-spacing:0.5px;font-weight:600;margin-bottom:8px;display:block}
.input{width:100%;background:var(--tg-theme-secondary-bg-color,#f8f9fa);border:none;border-radius:8px;padding:16px;font-size:17px;font-family:inherit;color:var(--tg-theme-text-color,#000)}
.input:focus{outline:none;background:rgba(0,122,255,0.1)}
.input::placeholder{color:var(--tg-theme-hint-color,#8e8e93)}
.row{display:flex;gap:12px}
.row .form-group{flex:1}
.menu{position:fixed;bottom:0;left:0;right:0;background:var(--tg-theme-bg-color,#fff);border-top:0.5px solid var(--tg-theme-hint-color,rgba(0,0,0,0.1));padding:20px;z-index:200;display:none}
.menu.show{display:block}
.menu-btn{width:100%;background:none;border:none;padding:16px;font-size:17px;text-align:left;cursor:pointer;border-radius:8px;margin-bottom:8px}
.menu-btn:active{background:var(--tg-theme-secondary-bg-color,#f8f9fa)}
.menu-btn.del{color:var(--tg-theme-destructive-text-color,#ff3b30)}
.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.3);z-index:150;display:none}
.overlay.show{display:block}
.add-btn-fixed{position:fixed;bottom:20px;left:20px;right:20px;background:var(--tg-theme-button-color,#007aff);color:var(--tg-theme-button-text-color,#fff);border:none;border-radius:8px;padding:16px;font-size:17px;font-weight:600;cursor:pointer;z-index:50;box-shadow:0 2px 10px rgba(0,0,0,0.1);display:none}
.add-btn-fixed:active{opacity:0.8}
.plans{margin-bottom:80px}
.teams-screen{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--tg-theme-bg-color,#fff);z-index:100;display:none;flex-direction:column}
.teams-screen.show{display:flex}
.teams-list{flex:1;padding:20px}
.team-item{background:var(--tg-theme-secondary-bg-color,#f8f9fa);border-radius:8px;padding:16px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}
.team-name{font-size:17px;flex:1}
.delete-team{background:none;border:none;color:var(--tg-theme-destructive-text-color,#ff3b30);font-size:15px;cursor:pointer;padding:8px}
.delete-team:active{opacity:0.6}
.add-team-form{padding:20px;border-top:0.5px solid var(--tg-theme-hint-color,rgba(0,0,0,0.1))}
.team-input{width:100%;background:var(--tg-theme-secondary-bg-color,#f8f9fa);border:none;border-radius:8px;padding:16px;font-size:17px;font-family:inherit;color:var(--tg-theme-text-color,#000);margin-bottom:12px}
.team-input:focus{outline:none;background:rgba(0,122,255,0.1)}
.team-input::placeholder{color:var(--tg-theme-hint-color,#8e8e93)}
.select-wrapper{position:relative}
.select{width:100%;background:var(--tg-theme-secondary-bg-color,#f8f9fa);border:none;border-radius:8px;padding:16px;font-size:17px;font-family:inherit;color:var(--tg-theme-text-color,#000);appearance:none;cursor:pointer}
.select:focus{outline:none;background:rgba(0,122,255,0.1)}
</style>
</head>
<body>
<div class="app">
<div class="header">
<button class="profile-btn" onclick="showProfile()">–ü</button>
<div class="date-nav">
<button class="nav" onclick="changeDay(-1)">‚Äπ</button>
<div>
<div class="date-title" id="dayTitle">–°–µ–≥–æ–¥–Ω—è</div>
<div class="date-subtitle" id="daySubtitle">–ü–Ω, 27 —è–Ω–≤.</div>
</div>
<button class="nav" onclick="changeDay(1)">‚Ä∫</button>
</div>
<button class="rooms-btn" onclick="showTeams()">üö™</button>
</div>
<div class="content" id="content">
<div class="empty" id="empty">
<h2>–ü–ª–∞–Ω–æ–≤ –Ω–µ—Ç</h2>
<p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω</p>
<button class="btn" onclick="showAdd()">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω</button>
</div>
<div class="plans" id="plans" style="display:none"></div>
</div>
</div>

<div class="add" id="add">
<div class="add-header">
<button class="header-btn" onclick="cancelAdd()">–û—Ç–º–µ–Ω–∞</button>
<div class="title">–ù–æ–≤—ã–π –ø–ª–∞–Ω</div>
<button class="header-btn" onclick="save()">–ì–æ—Ç–æ–≤–æ</button>
</div>
<div class="add-content">
<div class="form-group">
<label class="label">–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ</label>
<input class="input" id="title" placeholder="–ß—Ç–æ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å?" autofocus>
</div>
<div class="row">
<div class="form-group">
<label class="label">–î–∞—Ç–∞</label>
<input type="date" class="input" id="date">
</div>
<div class="form-group">
<label class="label">–í—Ä–µ–º—è</label>
<input type="time" class="input" id="time">
</div>
</div>
<div class="form-group">
<label class="label">–ö–æ–º–∞–Ω–¥–∞</label>
<div class="select-wrapper">
<select class="select" id="room">
<option value="">–ë–µ–∑ –∫–æ–º–∞–Ω–¥—ã</option>
</select>
</div>
</div>
</div>
</div>

<div class="overlay" id="overlay" onclick="hideMenu()"></div>
<div class="menu" id="menu">
<button class="menu-btn" onclick="edit()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="menu-btn del" onclick="del()">–£–¥–∞–ª–∏—Ç—å</button>
</div>

<button class="add-btn-fixed" onclick="showAdd()">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω</button>

<div class="teams-screen" id="teamsScreen">
<div class="add-header">
<button class="header-btn" onclick="hideTeams()">–ì–æ—Ç–æ–≤–æ</button>
<div class="title">–ö–æ–º–∞–Ω–¥—ã</div>
<div style="width:60px"></div>
</div>
<div class="teams-list" id="teamsList">
<!-- –ö–æ–º–∞–Ω–¥—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
<div class="add-team-form">
<input class="team-input" id="newTeam" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã">
<button class="btn" onclick="addTeam()">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
</div>
</div>

<script>
const tg=window.Telegram.WebApp;
tg.expand();
tg.ready();

let date=new Date();
let plans=[];
let teams=[];
let selected=null;

// –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
function escapeHtml(text){
const div=document.createElement('div');
div.textContent=text;
return div.innerHTML;
}

// –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
function loadPlans(){
try{
plans=JSON.parse(localStorage.getItem('plans')||'[]');
teams=JSON.parse(localStorage.getItem('teams')||'[]');
}catch(e){
plans=[];
teams=[];
}
render();
}

// –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
function render(){
const today=getPlansForDate(date);
document.getElementById('dayTitle').textContent=formatDate(date);
document.getElementById('daySubtitle').textContent=formatDateSubtitle(date);

const empty=document.getElementById('empty');
const plansEl=document.getElementById('plans');
const fixedBtn=document.querySelector('.add-btn-fixed');

if(today.length===0){
empty.style.display='flex';
plansEl.style.display='none';
fixedBtn.style.display='none';
return;
}

empty.style.display='none';
plansEl.style.display='block';
fixedBtn.style.display='block';

const withTime=today.filter(p=>p.time).sort((a,b)=>a.time.localeCompare(b.time));
const withoutTime=today.filter(p=>!p.time);

let html='';

if(withTime.length>0){
html+='<div class="group"><div class="group-title">–° –≤—Ä–µ–º–µ–Ω–µ–º</div>';
withTime.forEach(p=>{
html+=`<div class="plan" onclick="showMenu('${p.id}')">
<div class="time">${p.time}</div>
<div class="plan-content">
<div class="plan-title">${escapeHtml(p.title)}</div>
${p.room?`<div class="room">${escapeHtml(p.room)}</div>`:''}
</div>
</div>`;
});
html+='</div>';
}

if(withoutTime.length>0){
html+='<div class="group"><div class="group-title">–ë–µ–∑ –≤—Ä–µ–º–µ–Ω–∏</div>';
withoutTime.forEach(p=>{
html+=`<div class="plan" onclick="showMenu('${p.id}')">
<div class="plan-content">
<div class="plan-title">${escapeHtml(p.title)}</div>
${p.room?`<div class="room">${escapeHtml(p.room)}</div>`:''}
</div>
</div>`;
});
html+='</div>';
}

plansEl.innerHTML=html;
}

function formatDate(d){
const today=new Date();
const tomorrow=new Date(today);
tomorrow.setDate(tomorrow.getDate()+1);
const yesterday=new Date(today);
yesterday.setDate(yesterday.getDate()-1);

if(d.toDateString()===today.toDateString())return '–°–µ–≥–æ–¥–Ω—è';
if(d.toDateString()===tomorrow.toDateString())return '–ó–∞–≤—Ç—Ä–∞';
if(d.toDateString()===yesterday.toDateString())return '–í—á–µ—Ä–∞';
return d.toLocaleDateString('ru-RU',{weekday:'long',day:'numeric',month:'long'});
}

function formatDateSubtitle(d){
const days=['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
const months=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];
return `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]}.`;
}

function getPlansForDate(d){
const dateStr=d.toDateString();
return plans.filter(p=>new Date(p.date).toDateString()===dateStr);
}

function changeDay(dir){
date.setDate(date.getDate()+dir);
render();
}

function showAdd(){
document.getElementById('add').classList.add('show');
document.getElementById('date').value=date.toISOString().split('T')[0];
updateTeamsSelect();
setTimeout(()=>document.getElementById('title').focus(),50);
}

function showTeams(){
document.getElementById('teamsScreen').classList.add('show');
renderTeams();
}

function showProfile(){
// –ü–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã, –ø–æ–∑–∂–µ –Ω–∞—Å—Ç—Ä–æ–∏–º –ø—Ä–æ—Ñ–∏–ª—å
console.log('–ü—Ä–æ—Ñ–∏–ª—å - –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω');
}

function hideTeams(){
document.getElementById('teamsScreen').classList.remove('show');
}

function renderTeams(){
const teamsList=document.getElementById('teamsList');
let html='';
teams.forEach(team=>{
html+=`<div class="team-item">
<div class="team-name">${escapeHtml(team)}</div>
<button class="delete-team" onclick="deleteTeam('${escapeHtml(team)}')">–£–¥–∞–ª–∏—Ç—å</button>
</div>`;
});
teamsList.innerHTML=html;
}

function addTeam(){
const input=document.getElementById('newTeam');
const teamName=input.value.trim();
if(!teamName||teams.includes(teamName))return;

teams.push(teamName);
localStorage.setItem('teams',JSON.stringify(teams));
input.value='';
renderTeams();
}

function deleteTeam(teamName){
teams=teams.filter(t=>t!==teamName);
localStorage.setItem('teams',JSON.stringify(teams));
renderTeams();
}

function hideAdd(){
document.getElementById('add').classList.remove('show');
clearForm();
}

function cancelAdd(){
selected=null;
hideAdd();
}

function clearForm(){
document.getElementById('title').value='';
document.getElementById('date').value='';
document.getElementById('time').value='';
document.getElementById('room').value='';
}

function save(){
const title=document.getElementById('title').value.trim();
if(!title)return;

const roomSelect=document.getElementById('room');
const roomValue=roomSelect.value;

const plan={
title:title,
date:document.getElementById('date').value||date.toISOString().split('T')[0],
time:document.getElementById('time').value||null,
room:roomValue||null
};

if(selected){
const index=plans.findIndex(p=>p.id===selected);
if(index!==-1){
plans[index]={...plan,id:selected};
}
}else{
plan.id=Date.now().toString();
plans.push(plan);
}

localStorage.setItem('plans',JSON.stringify(plans));
selected=null;
hideAdd();
date=new Date(plan.date);
render();
}

function showMenu(id){
selected=id;
document.getElementById('overlay').classList.add('show');
document.getElementById('menu').classList.add('show');
}

function hideMenu(){
document.getElementById('overlay').classList.remove('show');
document.getElementById('menu').classList.remove('show');
}

function edit(){
const plan=plans.find(p=>p.id===selected);
if(!plan)return;

document.getElementById('title').value=plan.title;
document.getElementById('date').value=plan.date;
document.getElementById('time').value=plan.time||'';
document.getElementById('room').value=plan.room||'';

hideMenu();
showAdd();
}

function updateTeamsSelect(){
const select=document.getElementById('room');
select.innerHTML='<option value="">–ë–µ–∑ –∫–æ–º–∞–Ω–¥—ã</option>';
teams.forEach(team=>{
const option=document.createElement('option');
option.value=team;
option.textContent=team;
select.appendChild(option);
});
}

function del(){
plans=plans.filter(p=>p.id!==selected);
localStorage.setItem('plans',JSON.stringify(plans));
hideMenu();
render();
}

// Pull to refresh
let startY=0;
document.addEventListener('touchstart',e=>startY=e.touches[0].clientY);
document.addEventListener('touchend',e=>{
if(e.changedTouches[0].clientY-startY>80&&window.scrollY===0)showAdd();
});

// Telegram back button
tg.onEvent('backButtonClicked',()=>{
if(document.getElementById('teamsScreen').classList.contains('show'))hideTeams();
else if(document.getElementById('add').classList.contains('show'))cancelAdd();
else if(document.getElementById('menu').classList.contains('show'))hideMenu();
else tg.close();
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
document.addEventListener('keydown',e=>{
if(e.key==='Enter'&&document.getElementById('newTeam')===document.activeElement){
addTeam();
}
});

// –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç
loadPlans();
</script>
</body>
</html>