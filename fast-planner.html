<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>–ü–ª–∞–Ω–µ—Ä</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f2f2f7;color:var(--tg-theme-text-color,#000);line-height:1.4;overflow-x:hidden;min-height:100vh}
.app{min-height:100vh;display:flex;flex-direction:column}
.header{padding:16px 20px;background:#f2f2f7;display:flex;align-items:center;justify-content:space-between;position:relative}
.teams-header{padding:0 0 16px 0;text-align:right}
.teams-link{background:none;border:none;color:#007aff;font-size:15px;cursor:pointer;padding:8px 0}
.teams-link:active{opacity:0.6}
.date-nav{position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:8px;background:white;border-radius:16px;padding:6px 12px;box-shadow:0 1px 4px rgba(0,0,0,0.08)}
.date-title{font-size:15px;font-weight:600;color:#000;margin:0 6px;text-align:center;min-width:60px}
.date-subtitle{font-size:11px;color:#8e8e93;text-align:center}
.profile-btn{width:32px;height:32px;background:#007aff;border:none;border-radius:16px;display:flex;align-items:center;justify-content:center;color:white;font-size:14px;font-weight:600;cursor:pointer;flex-shrink:0}
.profile-btn:active{opacity:0.8}
.rooms-btn{width:32px;height:32px;background:white;border:none;border-radius:16px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,0.08);font-size:16px;flex-shrink:0}
.rooms-btn:active{opacity:0.8}
.nav{background:white;border:none;font-size:18px;color:#000;cursor:pointer;width:32px;height:32px;border-radius:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 4px rgba(0,0,0,0.1)}
.nav:active{opacity:0.6}
.teams-btn{background:none;border:none;font-size:24px;cursor:pointer;padding:0}
.teams-btn:active{opacity:0.6}
.title{font-size:17px;font-weight:600;flex:1;text-align:center;display:none}
.content{flex:1;padding:0;display:flex;flex-direction:column;padding-bottom:20px}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px 24px;min-height:200px}
.empty h2{font-size:20px;font-weight:500;margin-bottom:8px;color:#000}
.empty p{font-size:15px;color:#8e8e93;margin-bottom:32px}
.btn{background:#007aff;color:white;border:none;border-radius:12px;padding:14px 28px;font-size:17px;font-weight:600;cursor:pointer;box-shadow:0 4px 12px rgba(0,122,255,0.3);transition:all 0.2s ease}
.btn:active{opacity:0.8;transform:translateY(1px)}
.plans{flex:0}
.group{margin-bottom:16px}
.group-title{font-size:13px;color:var(--tg-theme-hint-color,#8e8e93);text-transform:uppercase;letter-spacing:0.5px;font-weight:600;margin-bottom:8px;padding:0 4px}
.progress-bar{height:8px;background:#f0f0f0;border-radius:4px;margin:0 24px 24px;overflow:hidden;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1)}
.progress-fill{height:100%;background:linear-gradient(90deg,#007aff 0%,#34c759 100%);border-radius:4px;transition:width 0.4s cubic-bezier(0.4,0,0.2,1);width:0%;position:relative}
.progress-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,rgba(255,255,255,0.3) 0%,transparent 50%,rgba(255,255,255,0.3) 100%);border-radius:4px}
.plan{background:white;border-radius:12px;padding:16px;margin:0 20px 12px;display:flex;align-items:center;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.06);border:0.5px solid rgba(0,0,0,0.04);transition:all 0.2s ease}
.plan:active{opacity:0.8;transform:scale(0.98)}
.plan.completed{opacity:0.6;background:#f8f9fa}
.plan.completed .plan-title{text-decoration:line-through;color:#8e8e93}
.plan.completed .time{background:#e5e5ea;color:#8e8e93}
.checkbox{width:20px;height:20px;border:2px solid #007aff;border-radius:10px;margin-right:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:all 0.2s ease}
.checkbox.checked{background:#007aff;border-color:#007aff}
.checkbox.checked::after{content:'‚úì';color:white;font-size:12px;font-weight:bold}
.time{font-size:15px;color:#007aff;font-weight:600;min-width:50px;margin-right:12px;background:rgba(0,122,255,0.1);padding:4px 8px;border-radius:6px}
.plan-content{flex:1}
.plan-title{font-size:17px;margin-bottom:2px;color:#000;font-weight:500}
.room{font-size:13px;color:#8e8e93;background:#f8f9fa;padding:2px 6px;border-radius:4px;display:inline-block;margin-top:4px}
.add{position:fixed;top:0;left:0;right:0;bottom:0;background:#f2f2f7;z-index:100;display:none;flex-direction:column;transform:translateY(100%);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1)}
.add.show{display:flex;transform:translateY(0)}
.add-header{padding:16px 20px;background:white;border-bottom:0.5px solid rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 0 rgba(0,0,0,0.05)}
.header-btn{background:none;border:none;font-size:17px;color:#007aff;cursor:pointer;padding:8px 12px;border-radius:8px;font-weight:500}
.header-btn:active{opacity:0.6;background:rgba(0,122,255,0.1)}
.add-content{flex:1;padding:24px 20px;overflow-y:auto}
.form-group{margin-bottom:24px}
.add-title{font-size:17px;font-weight:600;color:#000}
.label{font-size:13px;color:#8e8e93;text-transform:uppercase;letter-spacing:0.5px;font-weight:600;margin-bottom:8px;display:block}
.input{width:100%;background:white;border:2px solid transparent;border-radius:12px;padding:16px;font-size:17px;font-family:inherit;color:#000;box-shadow:0 2px 8px rgba(0,0,0,0.06);transition:all 0.2s ease}
.input:focus{outline:none;border-color:#007aff;box-shadow:0 4px 12px rgba(0,122,255,0.15)}
.input::placeholder{color:#c7c7cc}
.row{display:flex;gap:12px}
.row .form-group{flex:1}
.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);z-index:150;display:none;opacity:0;transition:opacity 0.3s ease}
.overlay.show{display:flex;opacity:1;align-items:center;justify-content:center}
.menu{background:white;border-radius:16px;padding:0;z-index:200;display:none;min-width:280px;box-shadow:0 10px 30px rgba(0,0,0,0.2);transform:scale(0.8);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1)}
.menu.show{display:block;transform:scale(1)}
.menu-btn{width:100%;background:none;border:none;padding:18px 20px;font-size:17px;text-align:center;cursor:pointer;border-radius:0;margin:0;color:#007aff;font-weight:500;transition:background 0.2s ease}
.menu-btn:first-child{border-radius:16px 16px 0 0}
.menu-btn:last-child{border-radius:0 0 16px 16px}
.menu-btn:only-child{border-radius:16px}
.menu-btn:not(:last-child){border-bottom:0.5px solid rgba(0,0,0,0.1)}
.menu-btn:active{background:#f0f0f0}
.menu-btn.del{color:#ff3b30}
.add-btn-fixed{position:fixed;bottom:24px;left:24px;right:24px;background:#007aff;color:white;border:none;border-radius:16px;padding:18px;font-size:17px;font-weight:600;cursor:pointer;z-index:50;box-shadow:0 8px 24px rgba(0,122,255,0.4);display:none;text-align:center}
.add-btn-fixed:active{opacity:0.8;transform:translateY(1px)}
.plans{margin-bottom:100px;padding-top:8px}
.teams-screen{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--tg-theme-bg-color,#fff);z-index:100;display:none;flex-direction:column}
.teams-screen.show{display:flex}
.teams-list{flex:1;padding:20px}
.team-item{background:var(--tg-theme-secondary-bg-color,#f8f9fa);border-radius:8px;padding:16px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}
.team-name{font-size:17px;flex:1}
.delete-team{background:none;border:none;color:var(--tg-theme-destructive-text-color,#ff3b30);font-size:15px;cursor:pointer;padding:8px}
.delete-team:active{opacity:0.6}
.add-team-form{padding:20px;border-top:0.5px solid var(--tg-theme-hint-color,rgba(0,0,0,0.1))}
.team-input{width:100%;background:var(--tg-theme-secondary-bg-color,#f8f9fa);border:none;border-radius:8px;padding:16px;font-size:17px;font-family:inherit;color:var(--tg-theme-text-color,#000);margin-bottom:12px}
.team-input:focus{outline:none;background:rgba(0,122,255,0.1)}
.team-input::placeholder{color:var(--tg-theme-hint-color,#8e8e93)}
.select-wrapper{position:relative}
.select{width:100%;background:white;border:2px solid transparent;border-radius:12px;padding:16px;font-size:17px;font-family:inherit;color:#000;appearance:none;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.06);transition:all 0.2s ease}
.select:focus{outline:none;border-color:#007aff;box-shadow:0 4px 12px rgba(0,122,255,0.15)}
.select-wrapper::after{content:'‚Ä∫';position:absolute;right:16px;top:50%;transform:translateY(-50%) rotate(90deg);color:#c7c7cc;font-size:18px;pointer-events:none}
</style>
</head>
<body>
<div class="app">
<div class="header">
<button class="profile-btn" onclick="showProfile()">–ü</button>
<div class="date-nav">
<button class="nav" onclick="changeDay(-1)">‚Äπ</button>
<div>
<div class="date-title" id="dayTitle">–°–µ–≥–æ–¥–Ω—è</div>
<div class="date-subtitle" id="daySubtitle">–ü–Ω, 27 —è–Ω–≤.</div>
</div>
<button class="nav" onclick="changeDay(1)">‚Ä∫</button>
</div>
<button class="rooms-btn" onclick="showTeams()">üö™</button>
</div>
<div class="content" id="content">
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="empty" id="empty">
<h2>–ü–ª–∞–Ω–æ–≤ –Ω–µ—Ç</h2>
<p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω</p>
<button class="btn" onclick="showAdd()">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω</button>
</div>
<div class="plans" id="plans" style="display:none"></div>
</div>
</div>

<div class="add" id="add">
<div class="add-header">
<button class="header-btn" onclick="cancelAdd()">–û—Ç–º–µ–Ω–∞</button>
<div class="add-title">–ù–æ–≤—ã–π –ø–ª–∞–Ω</div>
<button class="header-btn" onclick="save()">–ì–æ—Ç–æ–≤–æ</button>
</div>
<div class="add-content">
<div class="form-group">
<label class="label">–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ</label>
<input class="input" id="title" placeholder="–ß—Ç–æ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å?" autofocus>
</div>
<div class="form-group">
<label class="label">–î–∞—Ç–∞</label>
<input type="date" class="input" id="date">
</div>
<div class="form-group">
<label class="label">–ö–æ–º–∞–Ω–¥–∞</label>
<div class="select-wrapper">
<select class="select" id="room">
<option value="">–ë–µ–∑ –∫–æ–º–∞–Ω–¥—ã</option>
</select>
</div>
</div>
</div>
</div>

<div class="overlay" id="overlay" onclick="hideMenu()">
<div class="menu" id="menu" onclick="event.stopPropagation()">
<button class="menu-btn" onclick="edit()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="menu-btn del" onclick="del()">–£–¥–∞–ª–∏—Ç—å</button>
</div>
</div>

<button class="add-btn-fixed" onclick="showAdd()">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω</button>

<div class="teams-screen" id="teamsScreen">
<div class="add-header">
<button class="header-btn" onclick="hideTeams()">–ì–æ—Ç–æ–≤–æ</button>
<div class="title">–ö–æ–º–∞–Ω–¥—ã</div>
<div style="width:60px"></div>
</div>
<div class="teams-list" id="teamsList">
<!-- –ö–æ–º–∞–Ω–¥—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
<div class="add-team-form">
<input class="team-input" id="newTeam" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã">
<button class="btn" onclick="addTeam()">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
</div>
</div>

<script>
const tg=window.Telegram.WebApp;
tg.expand();
tg.ready();

let date=new Date();
let plans=[];
let teams=[];
let selected=null;

// –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
function escapeHtml(text){
const div=document.createElement('div');
div.textContent=text;
return div.innerHTML;
}

// –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
function loadPlans(){
try{
plans=JSON.parse(localStorage.getItem('plans')||'[]');
teams=JSON.parse(localStorage.getItem('teams')||'[]');
}catch(e){
plans=[];
teams=[];
}
render();
}

// –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
function render(){
const today=getPlansForDate(date);
document.getElementById('dayTitle').textContent=formatDate(date);
document.getElementById('daySubtitle').textContent=formatDateSubtitle(date);

// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤—Å–µ–≥–¥–∞
const completedCount=today.filter(p=>p.completed).length;
const totalCount=today.length;
const progressPercent=totalCount>0?(completedCount/totalCount)*100:0;
document.getElementById('progressFill').style.width=`${progressPercent}%`;

const empty=document.getElementById('empty');
const plansEl=document.getElementById('plans');
const fixedBtn=document.querySelector('.add-btn-fixed');

if(today.length===0){
empty.style.display='flex';
plansEl.style.display='none';
fixedBtn.style.display='none';
return;
}

empty.style.display='none';
plansEl.style.display='block';
fixedBtn.style.display='block';

let html='';

today.forEach(p=>{
html+=`<div class="plan ${p.completed?'completed':''}" onclick="showMenu('${p.id}')">
<div class="checkbox ${p.completed?'checked':''}" onclick="toggleComplete('${p.id}',event)"></div>
<div class="plan-content">
<div class="plan-title">${escapeHtml(p.title)}</div>
${p.room?`<div class="room">${escapeHtml(p.room)}</div>`:''}
</div>
</div>`;
});

plansEl.innerHTML=html;
}

function formatDate(d){
const today=new Date();
const tomorrow=new Date(today);
tomorrow.setDate(tomorrow.getDate()+1);
const yesterday=new Date(today);
yesterday.setDate(yesterday.getDate()-1);

if(d.toDateString()===today.toDateString())return '–°–µ–≥–æ–¥–Ω—è';
if(d.toDateString()===tomorrow.toDateString())return '–ó–∞–≤—Ç—Ä–∞';
if(d.toDateString()===yesterday.toDateString())return '–í—á–µ—Ä–∞';
return d.toLocaleDateString('ru-RU',{weekday:'long'});
}

function formatDateSubtitle(d){
const today=new Date();
const tomorrow=new Date(today);
tomorrow.setDate(tomorrow.getDate()+1);
const yesterday=new Date(today);
yesterday.setDate(yesterday.getDate()-1);

if(d.toDateString()===today.toDateString())return '–ü–Ω, 27 —è–Ω–≤.';
if(d.toDateString()===tomorrow.toDateString())return '–í—Ç, 28 —è–Ω–≤.';
if(d.toDateString()===yesterday.toDateString())return '–í—Å, 26 —è–Ω–≤.';

const days=['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
const months=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];
return `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]}.`;
}

function getPlansForDate(d){
const dateStr=d.toDateString();
return plans.filter(p=>new Date(p.date).toDateString()===dateStr);
}

function changeDay(dir){
date.setDate(date.getDate()+dir);
render();
}

function showAdd(){
const addScreen=document.getElementById('add');
addScreen.classList.add('show');
document.getElementById('date').value=date.toISOString().split('T')[0];
updateTeamsSelect();
setTimeout(()=>{
document.getElementById('title').focus();
},350);
}

function showTeams(){
document.getElementById('teamsScreen').classList.add('show');
renderTeams();
}

function showProfile(){
// –ü–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã, –ø–æ–∑–∂–µ –Ω–∞—Å—Ç—Ä–æ–∏–º –ø—Ä–æ—Ñ–∏–ª—å
console.log('–ü—Ä–æ—Ñ–∏–ª—å - –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω');
}

function hideTeams(){
document.getElementById('teamsScreen').classList.remove('show');
}

function renderTeams(){
const teamsList=document.getElementById('teamsList');
let html='';
teams.forEach(team=>{
html+=`<div class="team-item">
<div class="team-name">${escapeHtml(team)}</div>
<button class="delete-team" onclick="deleteTeam('${escapeHtml(team)}')">–£–¥–∞–ª–∏—Ç—å</button>
</div>`;
});
teamsList.innerHTML=html;
}

function addTeam(){
const input=document.getElementById('newTeam');
const teamName=input.value.trim();
if(!teamName||teams.includes(teamName))return;

teams.push(teamName);
localStorage.setItem('teams',JSON.stringify(teams));
input.value='';
renderTeams();
}

function deleteTeam(teamName){
teams=teams.filter(t=>t!==teamName);
localStorage.setItem('teams',JSON.stringify(teams));
renderTeams();
}

function hideAdd(){
const addScreen=document.getElementById('add');
addScreen.classList.remove('show');
setTimeout(()=>{
clearForm();
},300);
}

function cancelAdd(){
selected=null;
hideAdd();
}

function clearForm(){
document.getElementById('title').value='';
document.getElementById('date').value='';
document.getElementById('room').value='';
}

function save(){
const title=document.getElementById('title').value.trim();
if(!title)return;

const roomSelect=document.getElementById('room');
const roomValue=roomSelect.value;

const plan={
title:title,
date:document.getElementById('date').value||date.toISOString().split('T')[0],
time:null,
room:roomValue||null
};

if(selected){
const index=plans.findIndex(p=>p.id===selected);
if(index!==-1){
plans[index]={...plan,id:selected};
}
}else{
plan.id=Date.now().toString();
plans.push(plan);
}

localStorage.setItem('plans',JSON.stringify(plans));
selected=null;
hideAdd();
date=new Date(plan.date);
render();
}

function showMenu(id){
selected=id;
const overlay=document.getElementById('overlay');
const menu=document.getElementById('menu');
overlay.classList.add('show');
setTimeout(()=>{
menu.classList.add('show');
},50);
}

function hideMenu(){
const overlay=document.getElementById('overlay');
const menu=document.getElementById('menu');
menu.classList.remove('show');
setTimeout(()=>{
overlay.classList.remove('show');
},200);
}

function edit(){
const plan=plans.find(p=>p.id===selected);
if(!plan)return;

document.getElementById('title').value=plan.title;
document.getElementById('date').value=plan.date;
document.getElementById('room').value=plan.room||'';

hideMenu();
showAdd();
}

function updateTeamsSelect(){
const select=document.getElementById('room');
select.innerHTML='<option value="">–ë–µ–∑ –∫–æ–º–∞–Ω–¥—ã</option>';
teams.forEach(team=>{
const option=document.createElement('option');
option.value=team;
option.textContent=team;
select.appendChild(option);
});
}

function del(){
plans=plans.filter(p=>p.id!==selected);
localStorage.setItem('plans',JSON.stringify(plans));
hideMenu();
render();
}

function toggleComplete(id,event){
event.stopPropagation();
const plan=plans.find(p=>p.id===id);
if(plan){
plan.completed=!plan.completed;
localStorage.setItem('plans',JSON.stringify(plans));
render();
}
}

// Pull to refresh
let startY=0;
document.addEventListener('touchstart',e=>startY=e.touches[0].clientY);
document.addEventListener('touchend',e=>{
if(e.changedTouches[0].clientY-startY>80&&window.scrollY===0)showAdd();
});

// Telegram back button
tg.onEvent('backButtonClicked',()=>{
if(document.getElementById('teamsScreen').classList.contains('show'))hideTeams();
else if(document.getElementById('add').classList.contains('show'))cancelAdd();
else if(document.getElementById('menu').classList.contains('show'))hideMenu();
else tg.close();
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
document.addEventListener('keydown',e=>{
if(e.key==='Enter'&&document.getElementById('newTeam')===document.activeElement){
addTeam();
}
});

// –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç
loadPlans();
</script>
</body>
</html>