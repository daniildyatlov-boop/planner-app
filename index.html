<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>–ü–ª–∞–Ω–µ—Ä STABLE</title>
    <link rel="stylesheet" href="./src/styles/bundle.css">
</head>
<body>
    <div class="app">
        <div class="header">
            <button class="profile-btn" data-action="SHOW_PROFILE_MENU">–ü</button>
            <div class="date-nav">
                <button class="nav-arrow" data-action="CHANGE_DATE" data-params='{"days": -1}'>‚Äπ</button>
                <div class="date-content" data-action="SHOW_DATE_PICKER">
                    <div class="date-title" id="dayTitle">–°–µ–≥–æ–¥–Ω—è</div>
                    <div class="date-subtitle" id="daySubtitle">–ü–Ω, 27 —è–Ω–≤.</div>
                </div>
                <button class="nav-arrow" data-action="CHANGE_DATE" data-params='{"days": 1}'>‚Ä∫</button>
            </div>
            <button class="rooms-btn" data-action="SHOW_ROOMS_MODAL" id="roomsBtn">üè†</button>
        </div>

        <div class="content">
            <div class="progress-container" id="progressContainer">
                <div class="progress-info">
                    <div class="progress-label" id="progressLabel">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è</div>
                    <div class="progress-stats" id="progressStats">0/0</div>
                </div>
                <div class="progress-circle-container">
                    <div class="progress-circle" id="progressCircle">
                        <div class="progress-circle-inner">
                            <div class="progress-percentage" id="progressPercentage">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="empty" id="empty">
                <h2>–ü–ª–∞–Ω–æ–≤ –Ω–µ—Ç</h2>
                <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</p>
                <button class="btn" data-action="ADD_TASK_MODAL">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
            </div>

            <div class="plans-container" id="plansContainer" style="display:none">
                <div class="plans" id="plans"></div>
            </div>
            
            <div class="nutrition-container" id="nutritionContainer" style="display:none"></div>
            <div class="habits-container" id="habitsContainer" style="display:none"></div>
        </div>
    </div>

    <div class="bottom-nav" id="bottomNav">
        <button class="nav-item active" data-action="SWITCH_TAB" data-params='{"tab": "tasks"}' data-tab="tasks">
            <div class="nav-icon" id="tasksIcon">üìù</div>
            <div class="nav-label">–ó–∞–¥–∞—á–∏</div>
        </button>
        <button class="nav-item" data-action="SWITCH_TAB" data-params='{"tab": "nutrition"}' data-tab="nutrition">
            <div class="nav-icon" id="nutritionIcon">üçΩÔ∏è</div>
            <div class="nav-label">–ü–∏—Ç–∞–Ω–∏–µ</div>
        </button>
        <button class="nav-item" data-action="SWITCH_TAB" data-params='{"tab": "habits"}' data-tab="habits">
            <div class="nav-icon" id="habitsIcon">üéØ</div>
            <div class="nav-label">–ü—Ä–∏–≤—ã—á–∫–∏</div>
        </button>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–û—Ç–º–µ–Ω–∞</button>
            <div class="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</div>
            <button class="header-btn-primary" data-action="CREATE_TASK_FROM_MODAL">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="label">–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ</label>
                <input class="input" id="planTitle" placeholder="–ß—Ç–æ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å?" autofocus>
            </div>
            <div class="form-group">
                <label class="label">–î–∞—Ç–∞</label>
                <input type="date" class="input" id="planDate">
            </div>
            <div class="form-group">
                <label class="label">–í—Ä–µ–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <input type="time" class="input" id="planTime" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è">
            </div>
            <div class="form-group">
                <label class="label">–†–∞–∑–¥–µ–ª</label>
                <div class="select-wrapper">
                    <select class="select" id="planRoom">
                        <option value="">–ë–µ–∑ —Ä–∞–∑–¥–µ–ª–∞</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="calendar" id="calendar" data-action="HIDE_CALENDAR">
        <div class="calendar-content" data-action="NONE">
            <div class="calendar-header">
                <button class="calendar-nav" data-action="CHANGE_CALENDAR_MONTH" data-params='{"delta": -1}'>‚Äπ</button>
                <div class="calendar-title" id="calendarTitle">–Ø–Ω–≤–∞—Ä—å 2026</div>
                <button class="calendar-nav" data-action="CHANGE_CALENDAR_MONTH" data-params='{"delta": 1}'>‚Ä∫</button>
            </div>
            <div class="weekdays">
                <div class="weekday">–ü–Ω</div>
                <div class="weekday">–í—Ç</div>
                <div class="weekday">–°—Ä</div>
                <div class="weekday">–ß—Ç</div>
                <div class="weekday">–ü—Ç</div>
                <div class="weekday">–°–±</div>
                <div class="weekday">–í—Å</div>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>

    <div class="screen" id="editPlanScreen">
        <div class="screen-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–ù–∞–∑–∞–¥</button>
            <div class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É</div>
            <div></div>
        </div>
        <div class="screen-content">
            <div class="form-group">
                <input class="input edit-plan-input" id="editPlanTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
            </div>
            <div class="form-group">
                <label class="label">–î–∞—Ç–∞</label>
                <div class="form-row" data-action="SHOW_EDIT_DATE_PICKER">
                    <span id="editPlanDate">26 —è–Ω–≤. 2026–≥.</span>
                </div>
            </div>
            <div class="form-group">
                <label class="label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</label>
                <div class="form-row">
                    <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</span>
                    <div class="toggle" id="notificationToggle" data-action="TOGGLE_NOTIFICATION">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="label">–í–∞–∂–Ω–∞—è</label>
                <div class="form-row">
                    <span>–í–∞–∂–Ω–∞—è</span>
                    <div class="toggle" id="importantToggle" data-action="TOGGLE_IMPORTANT">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            <button class="delete-btn" data-action="DELETE_TASK_FROM_EDIT">–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É</button>
        </div>
        <div class="screen-footer">
            <button class="save-btn" data-action="SAVE_TASK_EDIT">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <div class="overlay" id="overlay" data-action="CLOSE_MODAL">
        <div class="menu" id="menu" data-action="NONE">
            <button class="menu-btn" data-action="EDIT_TASK_FROM_MENU">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="menu-btn del" data-action="DELETE_TASK_FROM_MENU">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>

    <div class="screen" id="roomsScreen">
        <div class="screen-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–ù–∞–∑–∞–¥</button>
            <div class="modal-title">–†–∞–∑–¥–µ–ª—ã</div>
            <button class="header-btn-primary" data-action="CLOSE_MODAL">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        <div class="screen-content">
            <div class="sections-manager-card" data-action="SHOW_SECTIONS" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 50%, rgba(168, 85, 247, 0.1) 100%);backdrop-filter: blur(30px);border: 1px solid rgba(99, 102, 241, 0.2);">
                <div class="sections-card-icon">üìö</div>
                <div class="sections-card-content">
                    <div class="sections-card-title">–†—É—Ç–∏–Ω—ã</div>
                    <div class="sections-card-desc">–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —É—Ç—Ä–æ, –≤–µ—á–µ—Ä –∏ –¥—Ä—É–≥–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –¥–µ–ª–∞</div>
                </div>
                <div class="sections-card-arrow">‚Ä∫</div>
            </div>
            <div class="rooms-list" id="roomsList"></div>
        </div>
        <button class="add-room-fab" data-action="SHOW_ADD_ROOM_MODAL">+</button>
    </div>

    <div class="screen" id="profileScreen">
        <div class="screen-header">
            <button class="header-btn" data-action="HIDE_PROFILE_MENU">–ù–∞–∑–∞–¥</button>
            <div class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <button class="header-btn-primary" data-action="HIDE_PROFILE_MENU">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        <div class="screen-content">
            <div class="profile-section">
                <div class="profile-avatar">
                    <div class="avatar-circle">–ü</div>
                    <div class="profile-name" id="profileName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <button class="edit-name-btn" data-action="EDIT_NAME">–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>
                </div>
            </div>
            <div class="profile-menu">
                <button class="profile-menu-btn" data-action="SHOW_ACCOUNT">
                    <div class="menu-btn-icon" id="profileIcon">üë§</div>
                    <div class="menu-btn-text">
                        <div class="menu-btn-title">–ê–∫–∫–∞—É–Ω—Ç</div>
                        <div class="menu-btn-desc">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥–ø–∏—Å–∫–∞</div>
                    </div>
                    <div class="menu-btn-arrow">‚Ä∫</div>
                </button>
                <button class="profile-menu-btn" data-action="SHOW_SETTINGS">
                    <div class="menu-btn-icon" id="settingsIcon">‚öôÔ∏è</div>
                    <div class="menu-btn-text">
                        <div class="menu-btn-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                        <div class="menu-btn-desc">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</div>
                    </div>
                    <div class="menu-btn-arrow">‚Ä∫</div>
                </button>
                <button class="profile-menu-btn" data-action="SHOW_SUPPORT">
                    <div class="menu-btn-icon" id="supportIcon">üí¨</div>
                    <div class="menu-btn-text">
                        <div class="menu-btn-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                        <div class="menu-btn-desc">–ü–æ–º–æ—â—å –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</div>
                    </div>
                    <div class="menu-btn-arrow">‚Ä∫</div>
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="addRoomModal">
        <div class="modal-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–û—Ç–º–µ–Ω–∞</button>
            <div class="modal-title">–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª</div>
            <button class="header-btn-primary" data-action="CREATE_ROOM_FROM_MODAL">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</label>
                <input class="input" id="newRoomTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–ø–æ—Ä—Ç">
            </div>
            <div class="form-group">
                <label class="label">–ò–∫–æ–Ω–∫–∞</label>
                <div class="icons-grid" id="roomIconsGrid"></div>
            </div>
        </div>
    </div>

    <div class="screen" id="sectionsScreen">
        <div class="screen-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–ù–∞–∑–∞–¥</button>
            <div class="modal-title">–†—É—Ç–∏–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã</div>
            <button class="header-btn-primary" data-action="CLOSE_MODAL">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        <div class="screen-content">
            <div id="sectionsList"></div>
        </div>
        <button class="add-room-fab" data-action="SHOW_ADD_SECTION_MODAL">+</button>
    </div>

    <div class="modal" id="addSectionModal">
        <div class="modal-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–û—Ç–º–µ–Ω–∞</button>
            <div class="modal-title">–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª</div>
            <button class="header-btn-primary" data-action="CREATE_SECTION_FROM_MODAL">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input class="input" id="newSectionTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—Ç—Ä–æ">
            </div>
        </div>
    </div>

    <div class="popup" id="popup">
        <div class="popup-content">
            <div class="popup-title" id="popupTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div>
            <div class="popup-message" id="popupMessage">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
            <div class="popup-buttons" id="popupButtons"></div>
        </div>
    </div>

 

.group{margin-bottom:16px}
.group-title{font-size:13px;color:var(--tg-theme-hint-color,#8e8e93);text-transform:uppercase;letter-spacing:0.5px;font-weight:600;margin-bottom:8px;padding:0 4px}
.progress-bar{height:8px;background:#f0f0f0;border-radius:4px;margin:0 24px 16px;overflow:hidden;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);flex-shrink:0}
.progress-fill{height:100%;background:linear-gradient(90deg,#007aff 0%,#34c759 100%);border-radius:4px;transition:width 0.4s cubic-bezier(0.4,0,0.2,1);width:0%;position:relative}
.progress-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,rgba(255,255,255,0.3) 0%,transparent 50%,rgba(255,255,255,0.3) 100%);border-radius:4px}
.plan{background:white;border-radius:16px;padding:20px;margin:0 24px 16px;display:flex;align-items:center;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.06);border:0.5px solid rgba(0,0,0,0.04);transition:all 0.2s ease;min-height:60px;flex-shrink:0}
.plan:active{opacity:0.8;transform:scale(0.98)}
.plan.completed{opacity:0.6;background:#f8f9fa}
.plan.completed .plan-title{text-decoration:line-through;color:#8e8e93}
.plan.completed .time{background:#e5e5ea;color:#8e8e93}
.checkbox{width:24px;height:24px;border:2px solid #007aff;border-radius:12px;margin-right:16px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:all 0.2s ease;font-size:12px;line-height:1}
.checkbox.checked{background:#007aff;border-color:#007aff}
.checkbox.checked::after{content:'‚úì';color:white;font-size:14px;font-weight:bold;display:flex;align-items:center;justify-content:center;width:100%;height:100%}
.time{font-size:15px;color:#007aff;font-weight:600;min-width:50px;margin-right:12px;background:rgba(0,122,255,0.1);padding:4px 8px;border-radius:6px}
.plan-content{flex:1;display:flex;flex-direction:column;justify-content:center}
.plan-title{font-size:17px;margin-bottom:0;color:#000;font-weight:500;line-height:1.3}
.room{font-size:12px;color:#8e8e93;background:#f0f0f0;padding:4px 8px;border-radius:6px;display:inline-block;margin-top:8px;line-height:1;font-weight:500}
.add{position:fixed;top:0;left:0;right:0;bottom:0;background:#f2f2f7;z-index:100;display:none;flex-direction:column;transform:translateY(100%);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);height:100vh;overflow:hidden}
.add.show{display:flex;transform:translateY(0)}
.add-header{padding:16px 20px;background:white;border-bottom:0.5px solid rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 0 rgba(0,0,0,0.05)}
.header-btn{background:none;border:none;font-size:17px;color:#007aff;cursor:pointer;padding:8px 12px;border-radius:8px;font-weight:500}
.header-btn:active{opacity:0.6;background:rgba(0,122,255,0.1)}
.add-content{flex:1;display:flex;flex-direction:column;overflow:hidden}
.form-section{padding:24px;flex:1;overflow-y:auto}
.form-section::-webkit-scrollbar{display:none}
.form-group{margin-bottom:24px}
.add-title{font-size:17px;font-weight:600;color:#000}
.label{font-size:13px;color:#8e8e93;text-transform:uppercase;letter-spacing:0.5px;font-weight:600;margin-bottom:8px;display:block;margin-left:0;padding:0}
.input,.select{width:100%;background:white;border:2px solid transparent;border-radius:12px;padding:16px;font-size:17px;font-family:inherit;color:#000;box-shadow:0 2px 8px rgba(0,0,0,0.06);transition:all 0.2s ease;box-sizing:border-box;margin:0;display:block;-webkit-appearance:none;appearance:none}
.input:focus,.select:focus{outline:none;border-color:#007aff;box-shadow:0 4px 12px rgba(0,122,255,0.15)}
.input::placeholder{color:#c7c7cc}
.input[type="date"]{position:relative;cursor:pointer}
.input[type="date"]::-webkit-calendar-picker-indicator{position:absolute;right:16px;top:50%;transform:translateY(-50%);cursor:pointer;opacity:0.6}
.select{cursor:pointer}
.select-wrapper{position:relative;width:100%;display:block}
.select-wrapper::after{content:'‚Ä∫';position:absolute;right:16px;top:50%;transform:translateY(-50%) rotate(90deg);color:#c7c7cc;font-size:18px;pointer-events:none}
.row{display:flex;gap:12px}
.row .form-group{flex:1}
.calendar{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);z-index:200;display:none;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s ease}
.calendar.show{display:flex;opacity:1}
.calendar-content{background:white;border-radius:16px;padding:20px;margin:20px;max-width:320px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.2);transform:scale(0.8);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1)}
.calendar.show .calendar-content{transform:scale(1)}
.calendar-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.calendar-title{font-size:18px;font-weight:600;color:#000}
.calendar-nav{background:none;border:none;font-size:20px;color:#007aff;cursor:pointer;width:32px;height:32px;border-radius:16px;display:flex;align-items:center;justify-content:center}
.calendar-nav:active{opacity:0.6;background:rgba(0,122,255,0.1)}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.calendar-day{background:none;border:none;padding:8px;font-size:14px;cursor:pointer;border-radius:8px;display:flex;align-items:center;justify-content:center;min-height:32px;transition:all 0.2s ease}
.calendar-day:hover{background:#f0f0f0}
.calendar-day.today{background:#007aff;color:white}
.calendar-day.selected{background:#34c759;color:white}
.calendar-day.other-month{color:#c7c7cc}
.weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-bottom:8px}
.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);z-index:150;display:none;opacity:0;transition:opacity 0.3s ease}
.overlay.show{display:flex;opacity:1;align-items:center;justify-content:center}
.menu{background:white;border-radius:16px;padding:0;z-index:200;display:none;min-width:280px;box-shadow:0 10px 30px rgba(0,0,0,0.2);transform:scale(0.8);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1)}
.menu.show{display:block;transform:scale(1)}
.menu-btn{width:100%;background:none;border:none;padding:18px 20px;font-size:17px;text-align:center;cursor:pointer;border-radius:0;margin:0;color:#007aff;font-weight:500;transition:background 0.2s ease}
.menu-btn:first-child{border-radius:16px 16px 0 0}
.menu-btn:last-child{border-radius:0 0 16px 16px}
.menu-btn:only-child{border-radius:16px}
.menu-btn:not(:last-child){border-bottom:0.5px solid rgba(0,0,0,0.1)}
.menu-btn:active{background:#f0f0f0}
.menu-btn.del{color:#ff3b30}
.add-btn-fixed{position:fixed;bottom:20px;left:20px;right:20px;background:#007aff;color:white;border:none;border-radius:16px;padding:18px;font-size:17px;font-weight:600;cursor:pointer;z-index:50;box-shadow:0 8px 24px rgba(0,122,255,0.4);display:none;text-align:center}
.add-btn-fixed:active{opacity:0.8;transform:translateY(1px)}
.rooms-screen{position:fixed;top:0;left:0;right:0;bottom:0;background:#f2f2f7;z-index:100;display:none;flex-direction:column;height:100vh;overflow:hidden}
.rooms-screen.show{display:flex}
.rooms-header{padding:12px 20px;background:white;border-bottom:0.5px solid rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 0 rgba(0,0,0,0.05);height:68px}
.rooms-list{flex:1;padding:20px 20px 100px;overflow-y:auto}
.rooms-list::-webkit-scrollbar{display:none}
.room-item{background:white;border-radius:16px;padding:20px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(0,0,0,0.06);border:0.5px solid rgba(0,0,0,0.04);transition:all 0.2s ease}
.room-item:active{opacity:0.8;transform:scale(0.98)}
.room-name{font-size:17px;font-weight:500;color:#000;flex:1}
.room-icon{font-size:20px;margin-right:12px}
.delete-room{background:none;border:none;color:#ff3b30;font-size:15px;cursor:pointer;padding:8px;border-radius:8px;font-weight:500}
.delete-room:active{opacity:0.6;background:rgba(255,59,48,0.1)}
.add-room-fab{position:fixed;bottom:24px;right:24px;width:56px;height:56px;background:#007aff;border:none;border-radius:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 8px 24px rgba(0,122,255,0.4);z-index:50;font-size:24px;color:white;transition:all 0.2s ease}
.add-room-fab:active{opacity:0.8;transform:scale(0.95)}
.add-room-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);z-index:200;display:none;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s ease}
.add-room-modal.show{display:flex;opacity:1}
.add-room-content{background:white;border-radius:16px;padding:24px;margin:20px;max-width:320px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.2);transform:scale(0.8);transition:transform 0.3s cubic-bezier(0.4,0,0.2,1)}
.add-room-modal.show .add-room-content{transform:scale(1)}
.add-room-title{font-size:18px;font-weight:600;color:#000;margin-bottom:20px;text-align:center}
.room-input-modal{width:100%;background:#f8f9fa;border:2px solid transparent;border-radius:12px;padding:16px;font-size:17px;font-family:inherit;color:#000;margin-bottom:16px;box-sizing:border-box;transition:all 0.2s ease}
.room-input-modal:focus{outline:none;border-color:#007aff;background:white;box-shadow:0 4px 12px rgba(0,122,255,0.15)}
.room-input-modal::placeholder{color:#8e8e93}
.modal-buttons{display:flex;gap:12px}
.modal-btn{flex:1;border:none;border-radius:12px;padding:14px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.2s ease}
.modal-btn.cancel{background:#f0f0f0;color:#000}
.modal-btn.cancel:active{opacity:0.8}
.modal-btn.add{background:#007aff;color:white}
.modal-btn.add:active{opacity:0.8;transform:translateY(1px)}
.select-wrapper{position:relative}
.select{width:100%;background:white;border:2px solid transparent;border-radius:12px;padding:16px;font-size:17px;font-family:inherit;color:#000;appearance:none;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.06);transition:all 0.2s ease;box-sizing:border-box}
.select:focus{outline:none;border-color:#007aff;box-shadow:0 4px 12px rgba(0,122,255,0.15)}
.select-wrapper::after{content:'‚Ä∫';position:absolute;right:16px;top:50%;transform:translateY(-50%) rotate(90deg);color:#c7c7cc;font-size:18px;pointer-events:none}
.profile-screen{position:fixed;top:0;left:0;right:0;bottom:0;background:#f2f2f7;z-index:100;display:none;flex-direction:column;height:100vh;overflow:hidden}
.profile-screen.show{display:flex}
.profile-header{padding:12px 20px;background:white;border-bottom:0.5px solid rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 0 rgba(0,0,0,0.05);height:68px}
.profile-content{flex:1;padding:0 0 20px;overflow-y:auto}
.profile-content::-webkit-scrollbar{display:none}
.profile-section{background:white;margin:20px 20px 0;border-radius:16px;padding:24px;box-shadow:0 2px 8px rgba(0,0,0,0.06);border:0.5px solid rgba(0,0,0,0.04)}
.profile-section:first-child{margin-top:20px}
.profile-avatar{display:flex;flex-direction:column;align-items:center;text-align:center}
.avatar-circle{width:80px;height:80px;background:#007aff;border-radius:40px;display:flex;align-items:center;justify-content:center;color:white;font-size:32px;font-weight:600;margin-bottom:16px}
.profile-name{font-size:20px;font-weight:600;color:#000;margin-bottom:8px}
.edit-name-btn{background:none;border:none;color:#007aff;font-size:15px;cursor:pointer;padding:8px 16px;border-radius:8px;font-weight:500}
.edit-name-btn:active{opacity:0.6;background:rgba(0,122,255,0.1)}
.section-title{font-size:17px;font-weight:600;color:#000;margin-bottom:20px}
.profile-list{display:flex;flex-direction:column}
.profile-item{display:flex;align-items:center;justify-content:space-between;padding:16px 0;border-bottom:0.5px solid rgba(0,0,0,0.1);cursor:pointer;transition:all 0.2s ease}
.profile-item:last-child{border-bottom:none}
.profile-item:active{opacity:0.6}
.profile-info{flex:1}
.profile-label{font-size:16px;font-weight:500;color:#000;margin-bottom:2px}
.profile-value{font-size:14px;color:#8e8e93}
.profile-desc{font-size:13px;color:#8e8e93}
.profile-arrow{font-size:18px;color:#c7c7cc;transform:rotate(0deg)}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.stat-item{text-align:center}
.stat-number{font-size:24px;font-weight:700;color:#007aff;margin-bottom:4px}
.stat-label{font-size:12px;color:#8e8e93;text-transform:uppercase;letter-spacing:0.5px;font-weight:600}
.settings-list{display:flex;flex-direction:column;gap:16px}
.setting-item{display:flex;align-items:center;justify-content:space-between}
.setting-info{flex:1}
.setting-name{font-size:16px;font-weight:500;color:#000;margin-bottom:2px}
.setting-desc{font-size:13px;color:#8e8e93}
.toggle{position:relative;display:inline-block;width:50px;height:30px}
.toggle input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#e5e5ea;transition:0.3s;border-radius:15px}
.toggle-slider:before{position:absolute;content:"";height:26px;width:26px;left:2px;bottom:2px;background:white;transition:0.3s;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
.toggle input:checked+.toggle-slider{background:#007aff}
.toggle input:checked+.toggle-slider:before{transform:translateX(20px)}
.app-info{display:flex;flex-direction:column;gap:12px}
.info-item{display:flex;justify-content:space-between;align-items:center}
.info-label{font-size:16px;color:#000}
.info-value{font-size:16px;color:#8e8e93}
.profile-menu{padding:20px;display:flex;flex-direction:column;gap:12px}
.profile-menu-btn{width:100%;background:white;border:none;border-radius:16px;padding:20px;display:flex;align-items:center;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.06);border:0.5px solid rgba(0,0,0,0.04);transition:all 0.2s ease;text-align:left}
.profile-menu-btn:active{opacity:0.8;transform:scale(0.98)}
.menu-btn-icon{font-size:24px;margin-right:16px;width:32px;display:flex;align-items:center;justify-content:center}
.menu-btn-text{flex:1}
.menu-btn-title{font-size:17px;font-weight:600;color:#000;margin-bottom:2px}
.menu-btn-desc{font-size:13px;color:#8e8e93}
.menu-btn-arrow{font-size:18px;color:#c7c7cc}
</head>
<body>
</head>
<body>
<div class="app">
<div class="header">
<button class="profile-btn" onclick="showProfile()">–ü</button>
<div class="date-nav">
<button class="nav-arrow" onclick="changeDay(-1)">‚Äπ</button>
<div class="date-content" onclick="showDatePicker()">
<div class="date-title" id="dayTitle">–°–µ–≥–æ–¥–Ω—è</div>
<div class="date-subtitle" id="daySubtitle">–ü–Ω, 27 —è–Ω–≤.</div>
</div>
<button class="nav-arrow" onclick="changeDay(1)">‚Ä∫</button>
</div>
<button class="rooms-btn" onclick="showRooms()">üè†</button>
</div>
<div class="content" id="content">
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="empty" id="empty">
<h2>–ü–ª–∞–Ω–æ–≤ –Ω–µ—Ç</h2>
<p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω</p>
<button class="btn" onclick="showAdd()">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω</button>
</div>
<div class="plans" id="plans" style="display:none"></div>
</div>
</div>

<div class="add" id="add">
<div class="add-header">
<button class="header-btn" onclick="cancelAdd()">–û—Ç–º–µ–Ω–∞</button>
<div class="add-title">–ù–æ–≤—ã–π –ø–ª–∞–Ω</div>
<button class="header-btn" onclick="save()">–ì–æ—Ç–æ–≤–æ</button>
</div>
<div class="add-content">
<div class="form-section">
<div class="form-group">
<label class="label">–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ</label>
<input class="input" id="title" placeholder="–ß—Ç–æ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å?" autofocus>
</div>
<div class="form-group">
<label class="label">–î–∞—Ç–∞</label>
<input type="date" class="input" id="date">
</div>
<div class="form-group">
<label class="label">–ö–æ–º–Ω–∞—Ç–∞</label>
<div class="select-wrapper">
<select class="select" id="room">
<option value="">–ë–µ–∑ –∫–æ–º–Ω–∞—Ç—ã</option>
</select>
</div>
</div>
</div>
</div>
</div>

<div class="calendar" id="calendar" onclick="hideCalendar()">
<div class="calendar-content" onclick="event.stopPropagation()">
<div class="calendar-header">
<button class="calendar-nav" onclick="changeCalendarMonth(-1)">‚Äπ</button>
<div class="calendar-title" id="calendarTitle">–Ø–Ω–≤–∞—Ä—å 2026</div>
<button class="calendar-nav" onclick="changeCalendarMonth(1)">‚Ä∫</button>
</div>
<div class="weekdays">
<div class="weekday">–ü–Ω</div>
<div class="weekday">–í—Ç</div>
<div class="weekday">–°—Ä</div>
<div class="weekday">–ß—Ç</div>
<div class="weekday">–ü—Ç</div>
<div class="weekday">–°–±</div>
<div class="weekday">–í—Å</div>
</div>
<div class="calendar-grid" id="calendarGrid">
<!-- –î–Ω–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
</div>
</div>

<div class="overlay" id="overlay" onclick="hideMenu()">
<div class="menu" id="menu" onclick="event.stopPropagation()">
<button class="menu-btn" onclick="edit()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="menu-btn del" onclick="del()">–£–¥–∞–ª–∏—Ç—å</button>
</div>
</div>

<button class="add-btn-fixed" onclick="showAdd()">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω</button>

<div class="rooms-screen" id="roomsScreen">
<div class="rooms-header">
<button class="header-btn" onclick="hideRooms()">–ù–∞–∑–∞–¥</button>
<div class="add-title">–ö–æ–º–Ω–∞—Ç—ã</div>
<div style="width:60px"></div>
</div>
<div class="rooms-list" id="roomsList">
<!-- –ö–æ–º–Ω–∞—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
<button class="add-room-fab" onclick="showAddRoomModal()">+</button>
</div>

<div class="add-room-modal" id="addRoomModal" onclick="hideAddRoomModal()">
<div class="add-room-content" onclick="event.stopPropagation()">
<div class="add-room-title">–ù–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞</div>
<input class="room-input-modal" id="newRoomModal" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" autofocus>
<div class="modal-buttons">
<button class="modal-btn cancel" onclick="hideAddRoomModal()">–û—Ç–º–µ–Ω–∞</button>
<button class="modal-btn add" id="addRoomBtn" onclick="addRoomFromModal()">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
</div>
</div>
</div>

<div class="profile-screen" id="profileScreen">
<div class="profile-header">
<button class="header-btn" onclick="hideProfile()">–ù–∞–∑–∞–¥</button>
<div class="add-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
<div style="width:60px"></div>
</div>
<div class="profile-content">
<div class="profile-section">
<div class="profile-avatar">
<div class="avatar-circle">–ü</div>
<div class="profile-name" id="profileName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
<button class="edit-name-btn" onclick="editName()">–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>
</div>
</div>

<div class="profile-menu">
<button class="profile-menu-btn" onclick="showAccount()">
<div class="menu-btn-icon">üë§</div>
<div class="menu-btn-text">
<div class="menu-btn-title">–ê–∫–∫–∞—É–Ω—Ç</div>
<div class="menu-btn-desc">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥–ø–∏—Å–∫–∞</div>
</div>
<div class="menu-btn-arrow">‚Ä∫</div>
</button>

<button class="profile-menu-btn" onclick="showSettings()">
<div class="menu-btn-icon">‚öôÔ∏è</div>
<div class="menu-btn-text">
<div class="menu-btn-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
<div class="menu-btn-desc">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</div>
</div>
<div class="menu-btn-arrow">‚Ä∫</div>
</button>

<button class="profile-menu-btn" onclick="showSupport()">
<div class="menu-btn-icon">üí¨</div>
<div class="menu-btn-text">
<div class="menu-btn-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
<div class="menu-btn-desc">–ü–æ–º–æ—â—å –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</div>
</div>
<div class="menu-btn-arrow">‚Ä∫</div>
</button>
</div>
</div>
</div>

 
console.log('üöÄ –ü–ª–∞–Ω–µ—Ä v5.1 STORAGE FIXED –∑–∞–≥—Ä—É–∂–µ–Ω - ' + new Date().toISOString());

const tg=window.Telegram?.WebApp;
let currentModal = null;

if (tg) {
  tg.ready();
  tg.expand();
  tg.enableClosingConfirmation();
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
  if (tg.themeParams) {
    document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#f2f2f7');
    document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#000000');
    document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color || '#8e8e93');
    document.documentElement.style.setProperty('--tg-theme-link-color', tg.themeParams.link_color || '#007aff');
    document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#007aff');
    document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
  }
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
  tg.BackButton.onClick(() => {
    if (currentModal) {
      hideCurrentModal();
    } else {
      tg.close();
    }
  });
  
  console.log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
} else {
  console.log('Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Ä–∞–±–æ—Ç–∞–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
}

let date=new Date();
let plans=[];
let teams=[];
let selected=null;

function escapeHtml(text){
const div=document.createElement('div');
div.textContent=text;
return div.innerHTML;
}

function loadPlans(){
try{
// –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const oldPlans = localStorage.getItem('plans');
const oldTeams = localStorage.getItem('teams');
if (oldPlans && !localStorage.getItem('planner_plans')) {
  localStorage.setItem('planner_plans', oldPlans);
  localStorage.removeItem('plans');
}
if (oldTeams && !localStorage.getItem('planner_teams')) {
  localStorage.setItem('planner_teams', oldTeams);
  localStorage.removeItem('teams');
}

plans=JSON.parse(localStorage.getItem('planner_plans')||'[]');
teams=JSON.parse(localStorage.getItem('planner_teams')||'[]');
}catch(e){
plans=[];
teams=[];
}
render();
}

function render(){
const today=getPlansForDate(date);
document.getElementById('dayTitle').textContent=formatDate(date);
document.getElementById('daySubtitle').textContent=formatDateSubtitle(date);

const completedCount=today.filter(p=>p.completed).length;
const totalCount=today.length;
const progressPercent=totalCount>0?(completedCount/totalCount)*100:0;
document.getElementById('progressFill').style.width=`${progressPercent}%`;

const empty=document.getElementById('empty');
const plansEl=document.getElementById('plans');
const fixedBtn=document.querySelector('.add-btn-fixed');

if(today.length===0){
empty.style.display='flex';
plansEl.style.display='none';
fixedBtn.style.display='none';
return;
}

empty.style.display='none';
plansEl.style.display='block';
fixedBtn.style.display='block';

let html='';
today.forEach(p=>{
html+=`<div class="plan ${p.completed?'completed':''}" onclick="showMenu('${p.id}')">
<div class="checkbox ${p.completed?'checked':''}" onclick="toggleComplete('${p.id}',event)"></div>
<div class="plan-content">
<div class="plan-title">${escapeHtml(p.title)}</div>
${p.room?`<div class="room">${escapeHtml(p.room)}</div>`:''}
</div>
</div>`;
});
plansEl.innerHTML=html;
}

function formatDate(d){
const today=new Date();
const tomorrow=new Date(today);
tomorrow.setDate(tomorrow.getDate()+1);
const yesterday=new Date(today);
yesterday.setDate(yesterday.getDate()-1);

if(d.toDateString()===today.toDateString())return '–°–µ–≥–æ–¥–Ω—è';
if(d.toDateString()===tomorrow.toDateString())return '–ó–∞–≤—Ç—Ä–∞';
if(d.toDateString()===yesterday.toDateString())return '–í—á–µ—Ä–∞';
return d.toLocaleDateString('ru-RU',{weekday:'long'});
}

function formatDateSubtitle(d){
const today=new Date();
const tomorrow=new Date(today);
tomorrow.setDate(tomorrow.getDate()+1);
const yesterday=new Date(today);
yesterday.setDate(yesterday.getDate()-1);

if(d.toDateString()===today.toDateString())return '–ü–Ω, 27 —è–Ω–≤.';
if(d.toDateString()===tomorrow.toDateString())return '–í—Ç, 28 —è–Ω–≤.';
if(d.toDateString()===yesterday.toDateString())return '–í—Å, 26 —è–Ω–≤.';

const days=['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
const months=['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'];
return `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]}.`;
}

function getPlansForDate(d){
const dateStr=d.toDateString();
return plans.filter(p=>new Date(p.date).toDateString()===dateStr);
}

function changeDay(dir){
date.setDate(date.getDate()+dir);
render();
}

function showAdd(){
const addScreen=document.getElementById('add');
addScreen.classList.add('show');
currentModal = 'add';
if (tg) tg.BackButton.show();
document.getElementById('date').value=date.toISOString().split('T')[0];
updateRoomsSelect();
setTimeout(()=>{
document.getElementById('title').focus();
},350);
}

function showRooms(){
document.getElementById('roomsScreen').classList.add('show');
renderRooms();
}

function showProfile(){
document.getElementById('profileScreen').classList.add('show');
loadProfileData();
}

function hideProfile(){
document.getElementById('profileScreen').classList.remove('show');
}

function loadProfileData(){
// –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const oldUserName = localStorage.getItem('userName');
if (oldUserName && !localStorage.getItem('planner_userName')) {
  localStorage.setItem('planner_userName', oldUserName);
  localStorage.removeItem('userName');
}

const userName=localStorage.getItem('planner_userName')||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
document.getElementById('profileName').textContent=userName;
}

function editName(){
const currentName=document.getElementById('profileName').textContent;
const newName=prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:',currentName);
if(newName&&newName.trim()){
const trimmedName=newName.trim();
document.getElementById('profileName').textContent=trimmedName;
localStorage.setItem('planner_userName',trimmedName);
const firstLetter=trimmedName.charAt(0).toUpperCase();
document.querySelector('.avatar-circle').textContent=firstLetter;
document.querySelector('.profile-btn').textContent=firstLetter;
}
}

function showAccount(){
alert('–ê–∫–∫–∞—É–Ω—Ç:\n\n–ü–ª–∞–Ω–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: ' + plans.length + '\n–ö–æ–º–Ω–∞—Ç —Å–æ–∑–¥–∞–Ω–æ: ' + teams.length + '\n–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: 27 —è–Ω–≤–∞—Ä—è 2025\n–ü–æ–¥–ø–∏—Å–∫–∞: –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω');
}

function showSettings(){
alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏:\n\n–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –í–∫–ª—é—á–µ–Ω—ã\n–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: GMT+3 (–ú–æ—Å–∫–≤–∞)\n–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π\n–¢–µ–º–∞: –°–∏—Å—Ç–µ–º–Ω–∞—è');
}

function showSupport(){
if(confirm('–û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É?\n\n–í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.')){
const message='–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –£ –º–µ–Ω—è –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –ü–ª–∞–Ω–µ—Ä v5.0 FINAL.';
const telegramUrl=`https://t.me/share/url?url=${encodeURIComponent(message)}`;
window.open(telegramUrl,'_blank');
}
}

function hideRooms(){
document.getElementById('roomsScreen').classList.remove('show');
}

function renderRooms(){
const roomsList=document.getElementById('roomsList');
const roomIcons=['üè†','üõèÔ∏è','üç≥','üõÅ','üíº','üèÉ','üìö','üéÆ','üåø','üîß'];
let html='';
teams.forEach((room,index)=>{
const icon=roomIcons[index%roomIcons.length];
html+=`<div class="room-item">
<div class="room-icon">${icon}</div>
<div class="room-name">${escapeHtml(room)}</div>
<button class="delete-room" onclick="deleteRoom('${escapeHtml(room)}')">–£–¥–∞–ª–∏—Ç—å</button>
</div>`;
});
roomsList.innerHTML=html;
}

function showAddRoomModal(){
const modal=document.getElementById('addRoomModal');
const input=document.getElementById('newRoomModal');
if(input)input.value='';
modal.classList.add('show');
setTimeout(()=>{
if(input)input.focus();
},300);
}

function hideAddRoomModal(){
document.getElementById('addRoomModal').classList.remove('show');
const input=document.getElementById('newRoomModal');
if(input)input.value='';
}

function addRoomFromModal(){
const input=document.getElementById('newRoomModal');
const roomName=input.value.trim();
if(!roomName)return;
if(teams.includes(roomName)){
alert('–ö–æ–º–Ω–∞—Ç–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
return;
}

teams.push(roomName);
localStorage.setItem('planner_teams',JSON.stringify(teams));
renderRooms();
updateRoomsSelect();
hideAddRoomModal();
}

function deleteRoom(roomName){
teams=teams.filter(t=>t!==roomName);
localStorage.setItem('planner_teams',JSON.stringify(teams));
renderRooms();
}

function hideAdd(){
const addScreen=document.getElementById('add');
addScreen.classList.remove('show');
setTimeout(()=>{
clearForm();
},300);
}

function cancelAdd(){
selected=null;
hideAdd();
}

function clearForm(){
document.getElementById('title').value='';
document.getElementById('date').value='';
document.getElementById('room').value='';
}

function save(){
const title=document.getElementById('title').value.trim();
if(!title)return;

const roomSelect=document.getElementById('room');
const roomValue=roomSelect.value;

const plan={
title:title,
date:document.getElementById('date').value||date.toISOString().split('T')[0],
time:null,
room:roomValue||null
};

if(selected){
const index=plans.findIndex(p=>p.id===selected);
if(index!==-1){
plans[index]={...plan,id:selected};
}
}else{
plan.id=Date.now().toString();
plans.push(plan);
}

localStorage.setItem('planner_plans',JSON.stringify(plans));
selected=null;
hideAdd();
date=new Date(plan.date);
render();
}

function showMenu(id){
selected=id;
const overlay=document.getElementById('overlay');
const menu=document.getElementById('menu');
overlay.classList.add('show');
setTimeout(()=>{
menu.classList.add('show');
},50);
}

function hideMenu(){
const overlay=document.getElementById('overlay');
const menu=document.getElementById('menu');
menu.classList.remove('show');
setTimeout(()=>{
overlay.classList.remove('show');
},200);
}

function edit(){
const plan=plans.find(p=>p.id===selected);
if(!plan)return;

document.getElementById('title').value=plan.title;
document.getElementById('date').value=plan.date;
document.getElementById('room').value=plan.room||'';

hideMenu();
showAdd();
}

function updateRoomsSelect(){
const select=document.getElementById('room');
select.innerHTML='<option value="">–ë–µ–∑ –∫–æ–º–Ω–∞—Ç—ã</option>';
teams.forEach(room=>{
const option=document.createElement('option');
option.value=room;
option.textContent=room;
select.appendChild(option);
});
}

function del(){
plans=plans.filter(p=>p.id!==selected);
localStorage.setItem('planner_plans',JSON.stringify(plans));
hideMenu();
render();
}

function toggleComplete(id,event){
event.stopPropagation();
const plan=plans.find(p=>p.id===id);
if(plan){
plan.completed=!plan.completed;
localStorage.setItem('planner_plans',JSON.stringify(plans));
render();
}
}

let calendarDate=new Date();

function showDatePicker(){
calendarDate=new Date(date);
renderCalendar();
document.getElementById('calendar').classList.add('show');
}

function hideCalendar(){
document.getElementById('calendar').classList.remove('show');
}

function changeCalendarMonth(dir){
calendarDate.setMonth(calendarDate.getMonth()+dir);
renderCalendar();
}

function selectDate(selectedDate){
date=new Date(selectedDate);
render();
hideCalendar();
}

    <script type="module" src="./src/main.js"></script>
</body>
</html>
