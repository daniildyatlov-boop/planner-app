<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>–ü–ª–∞–Ω–µ—Ä STABLE</title>
    <script src="https://telegram.org/js/telegram-web-app.js?v=7"></script>
    <link rel="stylesheet" href="styles/bundle.css">
</head>
<body>
    <div class="app">
        <div class="header">
            <button class="profile-btn" data-action="SHOW_PROFILE_MENU">–ü</button>
            <div class="date-nav">
                <button class="nav-arrow" data-action="CHANGE_DATE" data-params='{"days": -1}'>‚Äπ</button>
                <div class="date-content" data-action="SHOW_DATE_PICKER">
                    <div class="date-title" id="dayTitle">–°–µ–≥–æ–¥–Ω—è</div>
                    <div class="date-subtitle" id="daySubtitle">–ü–Ω, 27 —è–Ω–≤.</div>
                </div>
                <button class="nav-arrow" data-action="CHANGE_DATE" data-params='{"days": 1}'>‚Ä∫</button>
            </div>
            <button class="rooms-btn" data-action="SHOW_ROOMS_MODAL" id="roomsBtn">üè†</button>
        </div>

        <div class="content">
            <div class="progress-container" id="progressContainer">
                <div class="progress-info">
                    <div class="progress-label" id="progressLabel">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è</div>
                    <div class="progress-stats" id="progressStats">0/0</div>
                </div>
                <div class="progress-circle-container">
                    <div class="progress-circle" id="progressCircle">
                        <div class="progress-circle-inner">
                            <div class="progress-percentage" id="progressPercentage">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="empty" id="empty">
                <h2>–ü–ª–∞–Ω–æ–≤ –Ω–µ—Ç</h2>
                <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</p>
                <button class="btn" data-action="ADD_TASK_MODAL">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
            </div>

            <div class="plans-container" id="plansContainer" style="display:none">
                <div class="plans" id="plans"></div>
            </div>
            
            <!-- Nutrition Container (Hidden by default) -->
            <div class="nutrition-container" id="nutritionContainer" style="display:none">
                <!-- Content will be rendered by JS -->
            </div>

            <!-- Habits Container (Hidden by default) -->
            <div class="habits-container" id="habitsContainer" style="display:none">
                <!-- Content will be rendered by JS -->
            </div>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <div class="bottom-nav" id="bottomNav">
        <button class="nav-item active" data-action="SWITCH_TAB" data-params='{"tab": "tasks"}' data-tab="tasks">
            <div class="nav-icon" id="tasksIcon">üìù</div>
            <div class="nav-label">–ó–∞–¥–∞—á–∏</div>
        </button>
        <button class="nav-item" data-action="SWITCH_TAB" data-params='{"tab": "nutrition"}' data-tab="nutrition">
            <div class="nav-icon" id="nutritionIcon">üçΩÔ∏è</div>
            <div class="nav-label">–ü–∏—Ç–∞–Ω–∏–µ</div>
        </button>
        <button class="nav-item" data-action="SWITCH_TAB" data-params='{"tab": "habits"}' data-tab="habits">
            <div class="nav-icon" id="habitsIcon">üéØ</div>
            <div class="nav-label">–ü—Ä–∏–≤—ã—á–∫–∏</div>
        </button>
    </div>

    <!-- ADD PLAN MODAL -->
    <div class="modal" id="addModal">
        <div class="modal-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–û—Ç–º–µ–Ω–∞</button>
            <div class="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</div>
            <button class="header-btn-primary" data-action="CREATE_TASK_FROM_MODAL">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="label">–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ</label>
                <input class="input" id="planTitle" placeholder="–ß—Ç–æ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å?" autofocus>
            </div>
            <div class="form-group">
                <label class="label">–î–∞—Ç–∞</label>
                <input type="date" class="input" id="planDate">
            </div>
            <div class="form-group">
                <label class="label">–í—Ä–µ–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <input type="time" class="input" id="planTime" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è">
            </div>
            <div class="form-group">
                <label class="label">–†–∞–∑–¥–µ–ª</label>
                <div class="select-wrapper">
                    <select class="select" id="planRoom">
                        <option value="">–ë–µ–∑ —Ä–∞–∑–¥–µ–ª–∞</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- CALENDAR -->
    <div class="calendar" id="calendar" data-action="HIDE_CALENDAR">
        <div class="calendar-content" data-action="NONE">
            <div class="calendar-header">
                <button class="calendar-nav" data-action="CHANGE_CALENDAR_MONTH" data-params='{"delta": -1}'>‚Äπ</button>
                <div class="calendar-title" id="calendarTitle">–Ø–Ω–≤–∞—Ä—å 2026</div>
                <button class="calendar-nav" data-action="CHANGE_CALENDAR_MONTH" data-params='{"delta": 1}'>‚Ä∫</button>
            </div>
            <div class="weekdays">
                <div class="weekday">–ü–Ω</div>
                <div class="weekday">–í—Ç</div>
                <div class="weekday">–°—Ä</div>
                <div class="weekday">–ß—Ç</div>
                <div class="weekday">–ü—Ç</div>
                <div class="weekday">–°–±</div>
                <div class="weekday">–í—Å</div>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>

    <!-- EDIT PLAN SCREEN -->
    <div class="screen" id="editPlanScreen">
        <div class="screen-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–ù–∞–∑–∞–¥</button>
            <div class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É</div>
            <div></div>
        </div>
        <div class="screen-content">
            <div class="form-group">
                <input class="input edit-plan-input" id="editPlanTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
            </div>
            
            <div class="form-group">
                <label class="label">–î–∞—Ç–∞</label>
                <div class="form-row" data-action="SHOW_EDIT_DATE_PICKER">
                    <span id="editPlanDate">26 —è–Ω–≤. 2026–≥.</span>
                </div>
            </div>
            
            <div class="form-group">
                <label class="label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</label>
                <div class="form-row">
                    <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</span>
                    <div class="toggle" id="notificationToggle" data-action="TOGGLE_NOTIFICATION">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="label">–í–∞–∂–Ω–∞—è</label>
                <div class="form-row">
                    <span>–í–∞–∂–Ω–∞—è</span>
                    <div class="toggle" id="importantToggle" data-action="TOGGLE_IMPORTANT">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            
            <button class="delete-btn" data-action="DELETE_TASK_FROM_EDIT">
                –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É
            </button>
        </div>
        
        <div class="screen-footer">
            <button class="save-btn" data-action="SAVE_TASK_EDIT">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- MENU OVERLAY -->
    <div class="overlay" id="overlay" data-action="CLOSE_MODAL">
        <div class="menu" id="menu" data-action="NONE">
            <button class="menu-btn" data-action="EDIT_TASK_FROM_MENU">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="menu-btn del" data-action="DELETE_TASK_FROM_MENU">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    </div>

    <!-- ROOMS SCREEN -->
    <div class="screen" id="roomsScreen">
        <div class="screen-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–ù–∞–∑–∞–¥</button>
            <div class="modal-title">–†–∞–∑–¥–µ–ª—ã</div>
            <button class="header-btn-primary" data-action="CLOSE_MODAL">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        <div class="screen-content">
            <!-- Sections Manager Card -->
            <div class="sections-manager-card" data-action="SHOW_SECTIONS" style="
                background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 50%, rgba(168, 85, 247, 0.1) 100%);
                backdrop-filter: blur(30px);
                border: 1px solid rgba(99, 102, 241, 0.2);
                border-radius: var(--border-radius-lg);
                padding: var(--spacing-2xl);
                margin-bottom: var(--spacing-2xl);
                cursor: pointer;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                box-shadow: 0 8px 32px rgba(99, 102, 241, 0.15), 0 1px 0 rgba(255, 255, 255, 0.1) inset;">
                
                <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent); animation: sections-shimmer 4s infinite; pointer-events: none;"></div>
                
                <div style="position: relative; z-index: 2;">
                    <div style="display: flex; align-items: center; gap: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);" id="sectionsIcon">‚öôÔ∏è</div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 4px 0; font-size: 18px; font-weight: 700; color: var(--text-primary); text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);">–†—É—Ç–∏–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã</h3>
                            <p style="margin: 0; font-size: 14px; color: var(--text-secondary); line-height: 1.4;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</p>
                        </div>
                        <div style="color: var(--accent-primary); font-size: 20px; font-weight: 300;" class="sections-arrow">‚Ä∫</div>
                    </div>
                    
                    <div style="display: flex; gap: var(--spacing-lg); padding-top: var(--spacing-md); border-top: 1px solid rgba(99, 102, 241, 0.15);">
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 20px; font-weight: 700; color: var(--accent-primary); margin-bottom: 2px;" id="sectionsCount">0</div>
                            <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;">–†–∞–∑–¥–µ–ª–æ–≤</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 20px; font-weight: 700; color: var(--accent-secondary); margin-bottom: 2px;" id="activeSectionsToday">0</div>
                            <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;">–ê–∫—Ç–∏–≤–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 20px; font-weight: 700; color: var(--accent-soft); margin-bottom: 2px;" id="autoTasksToday">0</div>
                            <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;">–ó–∞–¥–∞—á —Å–æ–∑–¥–∞–Ω–æ</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: var(--spacing-lg);">
                <h3 style="color: var(--text-secondary); font-size: 14px; margin-bottom: var(--spacing-md); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">–û–±—ã—á–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã</h3>
                <div id="roomsList"></div>
                <button data-action="SHOW_ADD_ROOM_MODAL" style="width: 100%; background: var(--bg-card); border: 2px dashed var(--border-primary); border-radius: var(--border-radius); padding: var(--spacing-lg); color: var(--accent-primary); font-size: 14px; font-weight: 500; cursor: pointer; margin-top: var(--spacing-md); transition: all 0.3s ease;">
                    + –î–æ–±–∞–≤–∏—Ç—å –æ–±—ã—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª
                </button>
            </div>
        </div>
        <button class="add-room-fab" data-action="SHOW_ADD_ROOM_MODAL">+</button>
    </div>

    <!-- PROFILE SCREEN -->
    <div class="screen" id="profileScreen">
        <div class="screen-header">
            <button class="header-btn" data-action="HIDE_PROFILE_MENU">–ù–∞–∑–∞–¥</button>
            <div class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <button class="header-btn-primary" data-action="HIDE_PROFILE_MENU">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        <div class="screen-content">
            <div class="profile-section">
                <div class="profile-avatar">
                    <div class="avatar-circle">–ü</div>
                    <div class="profile-name" id="profileName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <button class="edit-name-btn" data-action="EDIT_NAME">–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>
                </div>
            </div>
            
            <div class="profile-menu">
                <button class="profile-menu-btn" data-action="SHOW_ACCOUNT">
                    <div class="menu-btn-icon" id="profileIcon">üë§</div>
                    <div class="menu-btn-text">
                        <div class="menu-btn-title">–ê–∫–∫–∞—É–Ω—Ç</div>
                        <div class="menu-btn-desc">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥–ø–∏—Å–∫–∞</div>
                    </div>
                    <div class="menu-btn-arrow">‚Ä∫</div>
                </button>
                <button class="profile-menu-btn" data-action="SHOW_SETTINGS">
                    <div class="menu-btn-icon" id="settingsIcon">‚öôÔ∏è</div>
                    <div class="menu-btn-text">
                        <div class="menu-btn-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                        <div class="menu-btn-desc">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</div>
                    </div>
                    <div class="menu-btn-arrow">‚Ä∫</div>
                </button>
                <button class="profile-menu-btn" data-action="SHOW_SUPPORT">
                    <div class="menu-btn-icon" id="supportIcon">üí¨</div>
                    <div class="menu-btn-text">
                        <div class="menu-btn-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                        <div class="menu-btn-desc">–ü–æ–º–æ—â—å –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</div>
                    </div>
                    <div class="menu-btn-arrow">‚Ä∫</div>
                </button>
            </div>
        </div>
    </div>

    <!-- ADD ROOM MODAL (New, was likely missing or dynamic) -->
    <div class="modal" id="addRoomModal">
        <div class="modal-header">
            <button class="header-btn" data-action="CLOSE_MODAL">–û—Ç–º–µ–Ω–∞</button>
            <div class="modal-title">–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª</div>
            <button class="header-btn-primary" data-action="CREATE_ROOM_FROM_MODAL">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</label>
                <input class="input" id="newRoomTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–ø–æ—Ä—Ç">
            </div>
            <div class="form-group">
                <label class="label">–ò–∫–æ–Ω–∫–∞</label>
                <div class="icons-grid" id="roomIconsGrid">
                    <!-- Icons will be rendered by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- POPUP -->
    <div class="popup" id="popup">
        <div class="popup-content">
            <div class="popup-title" id="popupTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div>
            <div class="popup-message" id="popupMessage">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
            <div class="popup-buttons" id="popupButtons"></div>
        </div>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>
