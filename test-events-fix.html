<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–¢–µ—Å—Ç —Å–æ–±—ã—Ç–∏–π - –ü–ª–∞–Ω–µ—Ä</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 20px; }
.test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
.btn { padding: 12px 20px; margin: 8px; border: none; border-radius: 6px; cursor: pointer; }
.btn-primary { background: #007AFF; color: white; }
.btn-secondary { background: #f0f0f0; color: #333; }
.log { background: #f8f8f8; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
</style>
</head>
<body>

<h1>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π</h1>

<div class="test-section">
  <h2>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏</h2>
  <button class="btn btn-primary" data-action="show-add">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
  <button class="btn btn-secondary" data-action="show-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button class="btn btn-secondary" data-action="show-rooms">–†–∞–∑–¥–µ–ª—ã</button>
</div>

<div class="test-section">
  <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–Ω—è–º</h2>
  <button class="btn btn-secondary" data-action="change-day" data-direction="-1">‚Üê –í—á–µ—Ä–∞</button>
  <button class="btn btn-secondary" data-action="show-date-picker">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
  <button class="btn btn-secondary" data-action="change-day" data-direction="1">–ó–∞–≤—Ç—Ä–∞ ‚Üí</button>
</div>

<div class="test-section">
  <h2>–°—á–µ—Ç—á–∏–∫–∏</h2>
  <button class="btn btn-secondary" data-action="decrease">‚àí</button>
  <span id="counter">3</span>
  <button class="btn btn-secondary" data-action="increase">+</button>
</div>

<div class="test-section">
  <h2>–í–æ–¥–∞</h2>
  <button class="btn btn-secondary" data-action="water-minus">‚àí –í–æ–¥–∞</button>
  <span id="water">0</span>
  <button class="btn btn-secondary" data-action="water-plus">+ –í–æ–¥–∞</button>
</div>

<div class="test-section">
  <h2>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
  <div class="log" id="eventLog">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π...</div>
  <button class="btn btn-secondary" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
</div>

<script>
// –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
let counter = 3;
let water = 0;

function logEvent(message) {
  const log = document.getElementById('eventLog');
  const time = new Date().toLocaleTimeString();
  log.innerHTML += `<div>[${time}] ${message}</div>`;
  log.scrollTop = log.scrollHeight;
}

function clearLog() {
  document.getElementById('eventLog').innerHTML = '–õ–æ–≥ –æ—á–∏—â–µ–Ω...<br>';
}

// –ó–∞–≥–ª—É—à–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π
function showAdd() { logEvent('‚úÖ showAdd() –≤—ã–∑–≤–∞–Ω–∞'); }
function showProfile() { logEvent('‚úÖ showProfile() –≤—ã–∑–≤–∞–Ω–∞'); }
function showRooms() { logEvent('‚úÖ showRooms() –≤—ã–∑–≤–∞–Ω–∞'); }
function changeDay(direction) { logEvent(`‚úÖ changeDay(${direction}) –≤—ã–∑–≤–∞–Ω–∞`); }
function showDatePicker() { logEvent('‚úÖ showDatePicker() –≤—ã–∑–≤–∞–Ω–∞'); }

function decreaseCounter() { 
  counter = Math.max(1, counter - 1);
  document.getElementById('counter').textContent = counter;
  logEvent(`‚úÖ decreaseCounter() - –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${counter}`);
}

function increaseCounter() { 
  counter = Math.min(7, counter + 1);
  document.getElementById('counter').textContent = counter;
  logEvent(`‚úÖ increaseCounter() - –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${counter}`);
}

function addWater() { 
  water++;
  document.getElementById('water').textContent = water;
  logEvent(`‚úÖ addWater() - –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${water}`);
}

function removeWater() { 
  water = Math.max(0, water - 1);
  document.getElementById('water').textContent = water;
  logEvent(`‚úÖ removeWater() - –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${water}`);
}

// –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –°–û–ë–´–¢–ò–ô
function handleGlobalClick(event) {
  const target = event.target;
  const closest = (selector) => target.closest(selector);
  
  // Prevent double-click issues
  if (event.detail > 1) {
    event.preventDefault();
    return;
  }
  
  try {
    // DEBUG: –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –∫–ª–∏–∫–∏ —Å data-action
    const actionElement = closest('[data-action]');
    if (actionElement) {
      const action = actionElement.dataset.action;
      logEvent(`üéØ ACTION CLICKED: ${action}`);
    }
    
    // Navigation buttons
    if (closest('[data-action="show-profile"]')) {
      event.preventDefault();
      showProfile();
      return;
    }
    
    if (closest('[data-action="change-day"]')) {
      event.preventDefault();
      const direction = parseInt(closest('[data-action="change-day"]').dataset.direction) || 0;
      changeDay(direction);
      return;
    }
    
    if (closest('[data-action="show-date-picker"]')) {
      event.preventDefault();
      showDatePicker();
      return;
    }
    
    if (closest('[data-action="show-rooms"]')) {
      event.preventDefault();
      showRooms();
      return;
    }
    
    // Add task button
    if (closest('[data-action="show-add"]')) {
      event.preventDefault();
      showAdd();
      return;
    }
    
    // Counter buttons
    if (closest('[data-action="decrease"]')) {
      event.preventDefault();
      decreaseCounter();
      return;
    }
    
    if (closest('[data-action="increase"]')) {
      event.preventDefault();
      increaseCounter();
      return;
    }
    
    // Water tracking buttons
    if (closest('[data-action="water-plus"]')) {
      event.preventDefault();
      addWater();
      return;
    }
    
    if (closest('[data-action="water-minus"]')) {
      event.preventDefault();
      removeWater();
      return;
    }
    
  } catch (error) {
    logEvent(`‚ùå Error in global click handler: ${error.message}`);
  }
}

function bindUIEvents() {
  try {
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–∏–≤—è–∑—ã–≤–∞–Ω–∏—è
    if (window.uiEventsBound) {
      logEvent('‚ö†Ô∏è UI events already bound, skipping');
      return;
    }
    
    // Remove all inline onclick handlers and replace with centralized event delegation
    document.addEventListener('click', handleGlobalClick);
    
    // –û—Ç–º–µ—á–∞–µ–º —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω—ã
    window.uiEventsBound = true;
    
    logEvent('‚úÖ UI events bound successfully');
  } catch (error) {
    logEvent(`‚ùå Error binding UI events: ${error.message}`);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
  logEvent('üöÄ DOM loaded, initializing...');
  bindUIEvents();
  logEvent('üéâ Test app ready! –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
});
</script>

</body>
</html>