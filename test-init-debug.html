<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Init Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .log { margin: 5px 0; }
        .error { color: #ff4444; }
        .success { color: #44ff44; }
        .info { color: #4444ff; }
    </style>
</head>
<body>
    <h1>ðŸ”§ Init Debug Test</h1>
    <div id="logs"></div>
    
    <script>
        const logs = document.getElementById('logs');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logs.appendChild(div);
            console.log(message);
        }
        
        // ÐŸÐµÑ€ÐµÑ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ console.log
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = (...args) => {
            log(args.join(' '), 'info');
            originalLog.apply(console, args);
        };
        
        console.error = (...args) => {
            log(args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        console.warn = (...args) => {
            log(args.join(' '), 'info');
            originalWarn.apply(console, args);
        };
        
        // Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ
        log('ðŸš€ ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ñ‚ÐµÑÑ‚ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸...', 'success');
        
        // Ð¡Ð¸Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
        const DEBUG = true;
        
        function debugLog(...args) {
            if (DEBUG) {
                log(`[DEBUG] ${args.join(' ')}`, 'info');
            }
        }
        
        function debugError(...args) {
            log(`[ERROR] ${args.join(' ')}`, 'error');
        }
        
        // Ð¡Ð¸Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÐ¼ appState
        const appState = {
            plans: [],
            habits: [],
            habitDayState: {},
            sections: [],
            currentDate: new Date()
        };
        
        // Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ñ‰Ð¸Ñ‚Ñƒ Ð¾Ñ‚ undefined
        function testUndefinedProtection() {
            log('ðŸ”§ Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð·Ð°Ñ‰Ð¸Ñ‚Ñƒ Ð¾Ñ‚ undefined...', 'info');
            
            // Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
            appState.habits = undefined;
            appState.habitDayState = undefined;
            appState.sections = undefined;
            appState.plans = undefined;
            
            // ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÐ¼ Ð·Ð°Ñ‰Ð¸Ñ‚Ñƒ
            appState.habits = appState.habits || [];
            appState.habitDayState = appState.habitDayState || {};
            appState.sections = appState.sections || [];
            appState.plans = appState.plans || [];
            
            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
            if (Array.isArray(appState.habits)) {
                log('âœ… habits Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹ Ð¾Ñ‚ undefined', 'success');
            } else {
                log('âŒ habits ÐÐ• Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹', 'error');
            }
            
            if (typeof appState.habitDayState === 'object') {
                log('âœ… habitDayState Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹ Ð¾Ñ‚ undefined', 'success');
            } else {
                log('âŒ habitDayState ÐÐ• Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹', 'error');
            }
            
            if (Array.isArray(appState.sections)) {
                log('âœ… sections Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹ Ð¾Ñ‚ undefined', 'success');
            } else {
                log('âŒ sections ÐÐ• Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹', 'error');
            }
            
            if (Array.isArray(appState.plans)) {
                log('âœ… plans Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹ Ð¾Ñ‚ undefined', 'success');
            } else {
                log('âŒ plans ÐÐ• Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹', 'error');
            }
        }
        
        // Ð¡Ð¸Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÐ¼ initApp
        function simulateInitApp() {
            debugLog('ðŸš€ Initializing Planner v6.28');
            
            try {
                // 1. Initialize icons
                debugLog('1. Initializing icons...');
                
                // 2. Load storage data
                debugLog('2. Loading storage data...');
                
                // 3. Migrate old data
                debugLog('3. Migrating old data...');
                
                // 4. Initialize sections sync
                debugLog('4. Initializing sections...');
                
                // 5. Initialize daily state
                debugLog('5. Initializing daily state...');
                testUndefinedProtection();
                
                // 6. Initialize nutrition and habits
                debugLog('6. Initializing modules...');
                
                // 7. Bind UI events
                debugLog('7. Binding UI events...');
                
                // 8. Render app
                debugLog('8. Rendering app...');
                
                // 9. Hide splash screen
                debugLog('9. Hiding splash screen...');
                
                debugLog('âœ… App initialized successfully');
                log('ðŸŽ‰ Ð˜ÐÐ˜Ð¦Ð˜ÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð¯ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ Ð£Ð¡ÐŸÐ•Ð¨ÐÐž!', 'success');
                
            } catch (error) {
                debugError('âŒ App initialization failed:', error);
                log('ðŸ’¥ ÐžÐ¨Ð˜Ð‘ÐšÐ Ð˜ÐÐ˜Ð¦Ð˜ÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð˜!', 'error');
            }
        }
        
        // Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ‚ÐµÑÑ‚
        setTimeout(() => {
            simulateInitApp();
        }, 1000);
        
    </script>
</body>
</html>