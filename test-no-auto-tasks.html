<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢–µ—Å—Ç: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
.test-container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; }
.test-result { padding: 10px; margin: 10px 0; border-radius: 8px; }
.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
button { padding: 10px 20px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; }
.btn-primary { background: #007bff; color: white; }
.btn-danger { background: #dc3545; color: white; }
.btn-success { background: #28a745; color: white; }
</style>
</head>
<body>

<div class="test-container">
  <h1>üß™ –¢–µ—Å—Ç: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤</h1>
  
  <div class="info">
    <h3>–¶–µ–ª—å —Ç–µ—Å—Ç–∞:</h3>
    <p>–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–∞–∑–¥–µ–ª—ã –ù–ï —Å–æ–∑–¥–∞—é—Ç –∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:</p>
    <ul>
      <li>–°–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞</li>
      <li>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ä–∞–∑–¥–µ–ª–∞</li>
      <li>–°–º–µ–Ω–µ –¥–∞—Ç—ã</li>
      <li>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
    </ul>
  </div>

  <div id="testResults"></div>
  
  <div style="margin-top: 20px;">
    <button class="btn-primary" onclick="runTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
    <button class="btn-danger" onclick="clearStorage()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å localStorage</button>
    <button class="btn-success" onclick="location.reload()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
  </div>
  
  <div style="margin-top: 20px;">
    <h3>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</h3>
    <div id="currentState"></div>
  </div>
</div>

<script>
// –≠–º—É–ª–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ app.html
let plans = [];
let sections = [];
let deletedTaskIds = [];
let currentDate = new Date();

// –§—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
function loadPlans() {
  const saved = localStorage.getItem('plans');
  if (saved) {
    const loadedPlans = JSON.parse(saved);
    plans.length = 0; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤
    loadedPlans.forEach(plan => plans.push(plan));
  }
}

function savePlans() {
  localStorage.setItem('plans', JSON.stringify(plans));
}

function loadSections() {
  const saved = localStorage.getItem('sections');
  if (saved) {
    sections = JSON.parse(saved);
  }
}

function saveSections() {
  localStorage.setItem('sections', JSON.stringify(sections));
}

// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: syncSectionsToPlans –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –û–¢–ö–õ–Æ–ß–ï–ù–ê
function syncSectionsToPlans(date) {
  console.log('‚ö†Ô∏è syncSectionsToPlans –û–¢–ö–õ–Æ–ß–ï–ù–ê - —Ä–∞–∑–¥–µ–ª—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç –∑–∞–¥–∞—á–∏');
  return; // –í—ã—Ö–æ–¥–∏–º —Å—Ä–∞–∑—É, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
}

// –≠–º—É–ª–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ (–ë–ï–ó –≤—ã–∑–æ–≤–∞ syncSectionsToPlans)
function createTestSection() {
  const newSection = {
    id: Date.now(),
    name: '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª',
    icon: 'üß™',
    activityRule: { type: 'daily' },
    templateTasks: [
      { id: 1, title: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ 1', time: '09:00' },
      { id: 2, title: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ 2', time: '10:00' }
    ],
    createdAt: new Date().toISOString()
  };
  
  sections.push(newSection);
  saveSections();
  
  // –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï —Å–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–∞–∑–¥–µ–ª–∞
  // syncSectionsToPlans(currentDate); // –£–ë–†–ê–ù–û
  
  return newSection;
}

// –≠–º—É–ª–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ (–ë–ï–ó –≤—ã–∑–æ–≤–∞ syncSectionsToPlans)
function editTestSection(sectionId) {
  const section = sections.find(s => s.id === sectionId);
  if (section) {
    section.name = '–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª';
    section.templateTasks.push({ id: 3, title: '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞', time: '11:00' });
    saveSections();
    
    // –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–ï —Å–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    // syncSectionsToPlans(currentDate); // –£–ë–†–ê–ù–û
  }
}

// –§—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function runTests() {
  const results = document.getElementById('testResults');
  results.innerHTML = '';
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
  loadPlans();
  loadSections();
  
  const initialPlansCount = plans.length;
  
  log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'info');
  log(`üìä –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: ${plans.length} –∑–∞–¥–∞—á, ${sections.length} —Ä–∞–∑–¥–µ–ª–æ–≤`, 'info');
  
  // –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏
  log('üß™ –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞', 'info');
  const testSection = createTestSection();
  
  if (plans.length === initialPlansCount) {
    log('‚úÖ –¢–µ—Å—Ç 1 –ü–†–û–ô–î–ï–ù: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ù–ï —Å–æ–∑–¥–∞–ª–æ –∑–∞–¥–∞—á–∏', 'success');
  } else {
    log(`‚ùå –¢–µ—Å—Ç 1 –ü–†–û–í–ê–õ–ï–ù: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ —Å–æ–∑–¥–∞–ª–æ ${plans.length - initialPlansCount} –∑–∞–¥–∞—á`, 'error');
  }
  
  // –¢–µ—Å—Ç 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏
  log('üß™ –¢–µ—Å—Ç 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞', 'info');
  const plansBeforeEdit = plans.length;
  editTestSection(testSection.id);
  
  if (plans.length === plansBeforeEdit) {
    log('‚úÖ –¢–µ—Å—Ç 2 –ü–†–û–ô–î–ï–ù: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ù–ï —Å–æ–∑–¥–∞–ª–æ –∑–∞–¥–∞—á–∏', 'success');
  } else {
    log(`‚ùå –¢–µ—Å—Ç 2 –ü–†–û–í–ê–õ–ï–ù: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ —Å–æ–∑–¥–∞–ª–æ ${plans.length - plansBeforeEdit} –∑–∞–¥–∞—á`, 'error');
  }
  
  // –¢–µ—Å—Ç 3: –í—ã–∑–æ–≤ syncSectionsToPlans –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏
  log('üß™ –¢–µ—Å—Ç 3: –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ syncSectionsToPlans', 'info');
  const plansBeforeSync = plans.length;
  syncSectionsToPlans(currentDate);
  
  if (plans.length === plansBeforeSync) {
    log('‚úÖ –¢–µ—Å—Ç 3 –ü–†–û–ô–î–ï–ù: syncSectionsToPlans –ù–ï —Å–æ–∑–¥–∞–ª–∞ –∑–∞–¥–∞—á–∏', 'success');
  } else {
    log(`‚ùå –¢–µ—Å—Ç 3 –ü–†–û–í–ê–õ–ï–ù: syncSectionsToPlans —Å–æ–∑–¥–∞–ª–∞ ${plans.length - plansBeforeSync} –∑–∞–¥–∞—á`, 'error');
  }
  
  // –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞
  log('üß™ –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏', 'info');
  const originalConsoleLog = console.log;
  let syncCalled = false;
  
  console.log = function(...args) {
    if (args[0] && args[0].includes('syncSectionsToPlans –û–¢–ö–õ–Æ–ß–ï–ù–ê')) {
      syncCalled = true;
    }
    originalConsoleLog.apply(console, args);
  };
  
  syncSectionsToPlans(currentDate);
  console.log = originalConsoleLog;
  
  if (syncCalled) {
    log('‚úÖ –¢–µ—Å—Ç 4 –ü–†–û–ô–î–ï–ù: –§—É–Ω–∫—Ü–∏—è syncSectionsToPlans –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞', 'success');
  } else {
    log('‚ùå –¢–µ—Å—Ç 4 –ü–†–û–í–ê–õ–ï–ù: –§—É–Ω–∫—Ü–∏—è syncSectionsToPlans –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏', 'error');
  }
  
  log('üèÅ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
  updateCurrentState();
}

function log(message, type = 'info') {
  const results = document.getElementById('testResults');
  const div = document.createElement('div');
  div.className = `test-result ${type}`;
  div.textContent = message;
  results.appendChild(div);
}

function clearStorage() {
  localStorage.clear();
  plans.length = 0;
  sections.length = 0;
  log('üóëÔ∏è localStorage –æ—á–∏—â–µ–Ω', 'info');
  updateCurrentState();
}

function updateCurrentState() {
  loadPlans();
  loadSections();
  
  const state = document.getElementById('currentState');
  state.innerHTML = `
    <p><strong>–ó–∞–¥–∞—á –≤ –ø–ª–∞–Ω–∞—Ö:</strong> ${plans.length}</p>
    <p><strong>–†–∞–∑–¥–µ–ª–æ–≤:</strong> ${sections.length}</p>
    <p><strong>–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞:</strong> ${currentDate.toISOString().split('T')[0]}</p>
  `;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', () => {
  updateCurrentState();
});
</script>

</body>
</html>