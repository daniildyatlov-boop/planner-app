<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .storage-info { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤</h1>
    
    <div class="test-step info">
        <h3>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</h3>
        <p>–£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ä—É—Ç–∏–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã</p>
        <p><strong>–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:</strong> –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –ù–ï –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è</p>
    </div>

    <div class="test-step">
        <h3>–®–∞–≥ 1: –û—á–∏—Å—Ç–∫–∞ localStorage</h3>
        <button onclick="clearStorage()">–û—á–∏—Å—Ç–∏—Ç—å localStorage</button>
        <div id="clear-result"></div>
    </div>

    <div class="test-step">
        <h3>–®–∞–≥ 2: –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
        <button onclick="simulateAppLoad()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        <div id="load-result"></div>
    </div>

    <div class="test-step">
        <h3>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤</h3>
        <button onclick="checkSections()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–¥–µ–ª—ã</button>
        <div id="sections-result"></div>
    </div>

    <div class="test-step">
        <h3>–®–∞–≥ 4: –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</h3>
        <button onclick="deleteTestSection()">–£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª "–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞"</button>
        <div id="delete-result"></div>
    </div>

    <div class="test-step">
        <h3>–®–∞–≥ 5: –°–∏–º—É–ª—è—Ü–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏</h3>
        <button onclick="simulateReload()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å reload</button>
        <div id="reload-result"></div>
    </div>

    <div class="test-step">
        <h3>–®–∞–≥ 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</h3>
        <button onclick="finalCheck()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        <div id="final-result"></div>
    </div>

    <div class="storage-info">
        <h4>–°–æ—Å—Ç–æ—è–Ω–∏–µ localStorage:</h4>
        <div id="storage-state"></div>
    </div>

    <script>
        // –ö–æ–ø–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ app.html
        let sections = [];
        let deletedSectionIds = [];

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏
        function isSectionDeleted(sectionId) {
            return deletedSectionIds.includes(sectionId);
        }

        function markSectionAsDeleted(sectionId) {
            if (!deletedSectionIds.includes(sectionId)) {
                deletedSectionIds.push(sectionId);
                saveDeletedSectionIds();
                console.log(`üóëÔ∏è –†–∞–∑–¥–µ–ª –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π: ${sectionId}`);
            }
        }

        function saveDeletedSectionIds() {
            try {
                localStorage.setItem('planner_deleted_section_ids', JSON.stringify(deletedSectionIds));
                console.log('–£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', deletedSectionIds);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤:', e);
            }
        }

        function loadDeletedSectionIds() {
            try {
                const saved = localStorage.getItem('planner_deleted_section_ids');
                deletedSectionIds = saved ? JSON.parse(saved) : [];
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:', deletedSectionIds);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤:', e);
                deletedSectionIds = [];
            }
        }

        function saveSections() {
            try {
                localStorage.setItem('planner_sections', JSON.stringify(sections));
                console.log('–†–∞–∑–¥–µ–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', sections);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤:', e);
            }
        }

        function loadSections() {
            try {
                const savedSections = localStorage.getItem('planner_sections');
                sections = savedSections ? JSON.parse(savedSections) : [];
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤: ${sections.length}`);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞–∑–¥–µ–ª–æ–≤:', e);
                sections = [];
            }
        }

        // –°–∏–º—É–ª—è—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê)
        function createDefaultSections() {
            console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã...');
            
            // –£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞ - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–µ–Ω –∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
            if (!isSectionDeleted(1001) && !sections.find(s => s.id === 1001)) {
                console.log('–°–æ–∑–¥–∞–µ–º —Ä–∞–∑–¥–µ–ª: –£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞');
                sections.push({
                    id: 1001,
                    name: '–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞',
                    icon: 'üèÉ',
                    activityRule: { type: 'daily' },
                    templateTasks: [
                        { id: 1, title: '–†–∞–∑–º–∏–Ω–∫–∞', time: '07:00' },
                        { id: 2, title: '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', time: '07:15' },
                        { id: 3, title: '–†–∞—Å—Ç—è–∂–∫–∞', time: '07:30' }
                    ],
                    createdAt: new Date().toISOString()
                });
            }
            
            // –£–±–æ—Ä–∫–∞ - —á–µ—Ä–µ–∑ –¥–µ–Ω—å (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–µ–Ω –∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
            if (!isSectionDeleted(1002) && !sections.find(s => s.id === 1002)) {
                console.log('–°–æ–∑–¥–∞–µ–º —Ä–∞–∑–¥–µ–ª: –£–±–æ—Ä–∫–∞ –¥–æ–º–∞');
                sections.push({
                    id: 1002,
                    name: '–£–±–æ—Ä–∫–∞ –¥–æ–º–∞',
                    icon: 'üßπ',
                    activityRule: { type: 'every_other_day', value: 0 },
                    templateTasks: [
                        { id: 4, title: '–ü—Ä–æ–ø—ã–ª–µ—Å–æ—Å–∏—Ç—å', time: '10:00' },
                        { id: 5, title: '–ü—Ä–æ—Ç–µ—Ä–µ—Ç—å –ø—ã–ª—å', time: '10:30' }
                    ],
                    createdAt: new Date().toISOString()
                });
            }
            
            // –†–∞–±–æ—Ç–∞ - —Ç–æ–ª—å–∫–æ –≤ –±—É–¥–Ω–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–µ–Ω –∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
            if (!isSectionDeleted(1003) && !sections.find(s => s.id === 1003)) {
                console.log('–°–æ–∑–¥–∞–µ–º —Ä–∞–∑–¥–µ–ª: –†–∞–±–æ—á–∏–µ –∑–∞–¥–∞—á–∏');
                sections.push({
                    id: 1003,
                    name: '–†–∞–±–æ—á–∏–µ –∑–∞–¥–∞—á–∏',
                    icon: 'üíº',
                    activityRule: { type: 'weekdays', value: [1, 2, 3, 4, 5] },
                    templateTasks: [
                        { id: 6, title: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É', time: '09:00' },
                        { id: 7, title: '–ü–ª–∞–Ω–µ—Ä–∫–∞', time: '10:00' },
                        { id: 8, title: '–û—Ç—á–µ—Ç –∑–∞ –¥–µ–Ω—å', time: '18:00' }
                    ],
                    createdAt: new Date().toISOString()
                });
            }
            
            saveSections();
            console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }

        // –°–∏–º—É–ª—è—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê)
        function deleteSection(sectionId) {
            const section = sections.find(s => s.id == sectionId);
            if (!section) return false;
            
            // –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ò–•: –ü–æ–º–µ—á–∞–µ–º —Ä–∞–∑–¥–µ–ª –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π –ü–ï–†–ï–î —É–¥–∞–ª–µ–Ω–∏–µ–º
            markSectionAsDeleted(sectionId);
            
            // –£–¥–∞–ª—è–µ–º —Ä–∞–∑–¥–µ–ª
            sections = sections.filter(s => s.id != sectionId);
            
            saveSections();
            
            console.log(`‚úÖ –†–∞–∑–¥–µ–ª "${section.name}" —É–¥–∞–ª–µ–Ω –∏ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π –Ω–∞–≤—Å–µ–≥–¥–∞`);
            return true;
        }

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function clearStorage() {
            localStorage.removeItem('planner_sections');
            localStorage.removeItem('planner_deleted_section_ids');
            sections = [];
            deletedSectionIds = [];
            
            document.getElementById('clear-result').innerHTML = 
                '<div class="success">‚úÖ localStorage –æ—á–∏—â–µ–Ω</div>';
            updateStorageState();
        }

        function simulateAppLoad() {
            loadDeletedSectionIds();
            loadSections();
            createDefaultSections();
            
            document.getElementById('load-result').innerHTML = 
                `<div class="success">‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ. –°–æ–∑–¥–∞–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤: ${sections.length}</div>`;
            updateStorageState();
        }

        function checkSections() {
            const sectionsHtml = sections.map(s => 
                `<li>ID: ${s.id}, –ù–∞–∑–≤–∞–Ω–∏–µ: "${s.name}", –ò–∫–æ–Ω–∫–∞: ${s.icon}</li>`
            ).join('');
            
            document.getElementById('sections-result').innerHTML = 
                `<div class="info">
                    <p>–í—Å–µ–≥–æ —Ä–∞–∑–¥–µ–ª–æ–≤: ${sections.length}</p>
                    <ul>${sectionsHtml}</ul>
                </div>`;
            updateStorageState();
        }

        function deleteTestSection() {
            const success = deleteSection(1001);
            
            document.getElementById('delete-result').innerHTML = success ?
                '<div class="success">‚úÖ –†–∞–∑–¥–µ–ª "–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞" —É–¥–∞–ª–µ–Ω</div>' :
                '<div class="error">‚ùå –†–∞–∑–¥–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
            updateStorageState();
        }

        function simulateReload() {
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É
            sections = [];
            deletedSectionIds = [];
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            loadDeletedSectionIds();
            loadSections();
            createDefaultSections();
            
            document.getElementById('reload-result').innerHTML = 
                `<div class="info">üîÑ –°–∏–º—É–ª—è—Ü–∏—è reload –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –†–∞–∑–¥–µ–ª–æ–≤: ${sections.length}</div>`;
            updateStorageState();
        }

        function finalCheck() {
            const deletedSection = sections.find(s => s.id === 1001);
            const isInDeletedList = deletedSectionIds.includes(1001);
            
            let result = '';
            if (!deletedSection && isInDeletedList) {
                result = '<div class="success">‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª –ù–ï –≤–µ—Ä–Ω—É–ª—Å—è!</div>';
            } else if (deletedSection) {
                result = '<div class="error">‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª –≤–µ—Ä–Ω—É–ª—Å—è!</div>';
            } else {
                result = '<div class="error">‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: –†–∞–∑–¥–µ–ª –Ω–µ –≤ —Å–ø–∏—Å–∫–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö!</div>';
            }
            
            document.getElementById('final-result').innerHTML = result;
            updateStorageState();
        }

        function updateStorageState() {
            const sectionsData = localStorage.getItem('planner_sections');
            const deletedData = localStorage.getItem('planner_deleted_section_ids');
            
            document.getElementById('storage-state').innerHTML = `
                <p><strong>planner_sections:</strong> ${sectionsData || '–ø—É—Å—Ç–æ'}</p>
                <p><strong>planner_deleted_section_ids:</strong> ${deletedData || '–ø—É—Å—Ç–æ'}</p>
                <p><strong>–í –ø–∞–º—è—Ç–∏ sections:</strong> ${sections.length} —Ä–∞–∑–¥–µ–ª–æ–≤</p>
                <p><strong>–í –ø–∞–º—è—Ç–∏ deletedSectionIds:</strong> [${deletedSectionIds.join(', ')}]</p>
            `;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateStorageState();
    </script>
</body>
</html>